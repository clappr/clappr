!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Clappr")):"function"==typeof define&&define.amd?define(["Clappr"],e):"object"==typeof exports?exports.DashShakaPlayback=e(require("Clappr")):t.DashShakaPlayback=e(t.Clappr)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(t,e,i){for(var n=!0;n;){var r=t,s=e,a=i;n=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,s);if(void 0!==o){if("value"in o)return o.value;var h=o.get;if(void 0===h)return;return h.call(a)}var u=Object.getPrototypeOf(r);if(null===u)return;t=u,e=s,i=a,n=!0,o=u=void 0}},h=i(2),u=i(1),l=n(u),c=3e4,f=-1,p=function(t){function e(t){r(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this._levels=[],t.autoPlay&&this.play()}return s(e,t),a(e,[{key:"name",get:function(){return"dash_shaka_playback"}},{key:"shakaVersion",get:function(){return l["default"].player.Player.version}},{key:"levels",get:function(){return this._levels}},{key:"currentLevel",set:function(t){var e=this;this._currentLevelId=t;var i=this._currentLevelId===f;this._player.configure({abr:{enable:!i}}),this.trigger(h.Events.PLAYBACK_LEVEL_SWITCH_START),i||this.selectTrack(this.videoTracks.filter(function(t){return t.id===e._currentLevelId})[0]),this.trigger(h.Events.PLAYBACK_LEVEL_SWITCH_END)},get:function(){return this._currentLevelId||f}}]),a(e,[{key:"play",value:function(){return!this._player&&this._setup(),this.isReady?void o(Object.getPrototypeOf(e.prototype),"play",this).call(this):void this.once(h.Events.PLAYBACK_READY,this.play)}},{key:"setupSrc",value:function(){}},{key:"ready",value:function(){}},{key:"error",value:function(t){h.Log.error("an error was raised support=",e.support),h.Log.error("an error was raised by the video tag",t,this.el.error)}},{key:"isHighDefinitionInUse",value:function(){return!!this.highDefinition}},{key:"stop",value:function(){var t=this;clearInterval(this.sendStatsId),this.trigger(h.Events.PLAYBACK_STOP,this.name),this._sendStats(),this._player.unload().then(function(){t._player=null,t._isShakaReadyState=!1})["catch"](function(){h.Log.error("shaka could not be unloaded")})}},{key:"getPlaybackType",value:function(){return(this._player&&this._player.isLive()?"live":"vod")||""}},{key:"selectTrack",value:function(t){this._player.selectTrack(t),this._onAdaptation()}},{key:"destroy",value:function(){var t=this;clearInterval(this.sendStatsId),this._player?this._destroy():this._player.destroy().then(function(){return t._destroy()})["catch"](function(){t._destroy(),h.Log.error("shaka could not be destroyed")})}},{key:"_setup",value:function(){var t=this;this._isShakaReadyState=!1,this._player=this._createPlayer(),this._options.shakaConfiguration&&this._player.configure(this._options.shakaConfiguration);var e=this._player.load(this._options.src);e.then(function(){return t._loaded()})["catch"](function(e){return t._setupError(e)})}},{key:"_createPlayer",value:function(){var t=this,e=new l["default"].Player(this.el);return e.addEventListener("error",function(e,i){return t._error(e,i)}),e.addEventListener("adaptation",function(){return t._onAdaptation()}),e.addEventListener("buffering",function(e){return t._onBuffering(e)}),e}},{key:"_onBuffering",value:function(t){var e=t.buffering?h.Events.PLAYBACK_BUFFERING:h.Events.PLAYBACK_BUFFERFULL;this.trigger(e)}},{key:"_loaded",value:function(){this._isShakaReadyState=!0,this._ready(),this._startToSendStats(),this._fillLevels()}},{key:"_fillLevels",value:function(){0===this._levels.length&&(this._levels=this.videoTracks.map(function(t){return{id:t.id,label:t.height+"p"}}).reverse(),this.trigger(h.Events.PLAYBACK_LEVELS_AVAILABLE,this.levels))}},{key:"_startToSendStats",value:function(){var t=this;this.sendStatsId=setInterval(function(){return t._sendStats()},c)}},{key:"_sendStats",value:function(){this.trigger(h.Events.PLAYBACK_STATS_ADD,this._player.getStats())}},{key:"_setupError",value:function(t){this._error("error",{detail:t.detail})}},{key:"_error",value:function(t,i){h.Log.error("an error was raised support=",e.support),h.Log.error("an error was raised by shaka player",i.detail),this.trigger(h.Events.PLAYBACK_ERROR,i.detail,this.name)}},{key:"_onAdaptation",value:function(){var t=this.videoTracks.filter(function(t){return t.active===!0})[0];this._fillLevels(),h.Log.debug("an adaptation has happened:",t),this.highDefinition=t.height>=720,this.trigger(h.Events.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(h.Events.PLAYBACK_BITRATE,{bandwidth:t.bandwidth,width:t.width,height:t.height,level:t.id})}},{key:"_destroy",value:function(){o(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._isShakaReadyState=!1,h.Log.debug("shaka was destroyed")}},{key:"_ready",value:function(){o(Object.getPrototypeOf(e.prototype),"_ready",this).call(this)}},{key:"isReady",get:function(){return this._isShakaReadyState}},{key:"textTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"text"===t.type})}},{key:"audioTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"audio"===t.type})}},{key:"videoTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"video"===t.type})}}]),e}(h.HTML5Video);e["default"]=p,p.canPlay=function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1];l["default"].polyfill.installAll(),l["default"].Player.support().then(function(t){p.support=t});var i=!!window.Promise&&!!window.Uint8Array&&!!Array.prototype.forEach,n=window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=i&&n,s=t.split("?")[0].match(/.*\.(.*)$/)||[];return r&&("mpd"===s[1]||e.indexOf("application/dash+xml")>-1)},t.exports=e["default"]},function(t,e,i){var n;!function(){var r={};(function(t){function e(t,e){var i=t.split("."),n=Wr;i[0]in n||!n.execScript||n.execScript("var "+i[0]);for(var r;i.length&&(r=i.shift());)i.length||void 0===e?n=n[r]?n[r]:n[r]={}:n[r]=e}function i(t,e){function i(){}i.prototype=e.prototype,t.Zb=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.Yb=function(t,i,n){return e.prototype[i].apply(t,Array.prototype.slice.call(arguments,2))}}function n(t,e){this.id=t,this.lang=e||"unknown",this.enabled=this.active=!1}function r(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}function s(t,e,i,n){this.id=t,this.bandwidth=e||0,this.width=i||0,this.height=n||0,this.active=!1}function a(t,e){var i=t.width*t.height,n=e.width*e.height;return i<n?-1:i>n?1:t.bandwidth<e.bandwidth?-1:t.bandwidth>e.bandwidth?1:0}function o(t,e,i){this.id=t,this.bandwidth=e||0,this.lang=i||"unknown",this.active=!1}function h(){var t,e,i=new Promise(function(i,n){t=i,e=n});return i.resolve=t,i.reject=e,i.destroy=h.prototype.destroy,i}function u(t,e){return e.bind(t)}function l(t){return Object.keys(t).map(function(e){return t[e]})}function c(t,e){return d(t,e,"boolean")}function f(t,e){var i=d(t,e,"number");if(null==i)return null;if(isNaN(i)||i==Number.NEGATIVE_INFINITY||i==Number.POSITIVE_INFINITY)throw new RangeError("'"+e+"' must be finite.");if(0>i)throw new RangeError("'"+e+"' must be >= 0");return i}function p(t,e){return d(t,e,"string")}function d(t,e,i){if(t=t[e],null==t)return null;if(typeof t!=i)throw new TypeError("'"+e+"' must be a "+i+".");return t}function y(t,e,i){if(t=t[e],null==t)return null;if(!(t instanceof i))throw new TypeError("'"+e+"' must be an instance of "+i.name+".");return t}function b(t){return t.split("").reduce(function(t,e,i){return t+(i&&0==i%4?" "+e:e)})}function v(t,e){for(var i=[],n=0;n<t.length;++n){for(var r=!1,s=0;s<i.length&&!(r=e?e(t[n],i[s]):t[n]===i[s]);++s);r||i.push(t[n])}return i}function g(t){return String.fromCharCode.apply(null,t)}function m(t){for(var e=new Uint8Array(t.length),i=0;i<t.length;++i)e[i]=t.charCodeAt(i);return e}function w(e){return m(t.atob(e.replace(/-/g,"+").replace(/_/g,"/")))}function T(t){for(var e="",i=0;i<t.length;++i){var n=t[i].toString(16);1==n.length&&(n="0"+n),e+=n}return e}function E(t,e){if(!t&&!e)return!0;if(!t||!e||t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!=e[i])return!1;return!0}function k(t){this.b=t,this.a=new W(t),$r||($r=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function P(t){var e;if(e=S(t),7<e.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var i=0,n=0;n<e.length;n++)i=256*i+e[n];e=i,i=S(t);t:{for(n=0;n<$r.length;n++)if(E(i,$r[n])){n=!0;break t}n=!1}if(n)i=t.b.byteLength-t.a.a;else{if(8==i.length&&224&i[1])throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var n=i[0]&(1<<8-i.length)-1,r=1;r<i.length;r++)n=256*n+i[r];i=n}return i=t.a.a+i<=t.b.byteLength?i:t.b.byteLength-t.a.a,n=new DataView(t.b.buffer,t.b.byteOffset+t.a.a,i),tt(t.a,i),new j(e,n)}function S(t){var e,i=$(t.a);for(e=1;8>=e&&!(i&1<<8-e);e++);if(8<e)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var n=new Uint8Array(e);for(n[0]=i,i=1;i<e;i++)n[i]=$(t.a);return n}function j(t,e){this.id=t,this.a=e}function A(t){if(8<t.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==t.a.byteLength&&224&t.a.getUint8(0))throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var e=0,i=0;i<t.a.byteLength;i++)var n=t.a.getUint8(i),e=256*e+n;return e}function _(){this.a={}}function M(t){var e,i=[];for(e in t.a)i.push.apply(i,t.a[e]);return i}function I(t,e,i){if(t=t.a[e])for(e=0;e<t.length;++e)t[e]==i&&(t.splice(e,1),--e)}function N(t){var e,i=[];for(e in t.a)i.push(e);return i}function R(){return Date.now()+Xr}function C(){}function D(){this.h=this.a="",this.i=!1,this.s=this.l=null,this.v=this.g=!1,this.j=this.f="",this.c=null,this.b=[]}function x(t){var e=new D;if(!t)return e;var i=p(t,"keySystem");if(null==i)throw Error("'keySystem' cannot be null.");e.a=i;var n=p(t,"licenseServerUrl");if(null!=n)e.h=n;else if(i)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");if(i=c(t,"withCredentials"),null!=i&&(e.i=i),i=y(t,"licensePostProcessor",Function),null!=i&&(e.l=i),i=y(t,"licensePreProcessor",Function),null!=i&&(e.s=i),i=c(t,"distinctiveIdentifierRequired"),null!=i&&(e.g=i),i=c(t,"persistentStateRequired"),null!=i&&(e.v=i),i=p(t,"audioRobustness"),null!=i&&(e.f=i),i=p(t,"videoRobustness"),null!=i&&(e.j=i),i=y(t,"serverCertificate",Uint8Array),null!=i&&(e.c=i),i=y(t,"initData",Object)){if(t=y(i,"initData",Uint8Array),null==t)throw Error("'initData.initData' cannot be null.");if(i=p(i,"initDataType"),null==i)throw Error("'initData.initDataType' cannot be null.");e.b.push({initData:new Uint8Array(t.buffer),initDataType:i})}return e}function O(t,e){var i=new D;return i.a=t.a,i.h=t.h,i.i=t.i,i.l=t.l,i.s=t.s,i.g=t.g,i.v=t.v,i.f=t.f,i.j=t.j,i.c=t.c?new Uint8Array(t.c.buffer):null,L(i,t.b),L(i,e.b),i}function L(t,e){var i=t.b.concat(e.map(function(t){return{initData:new Uint8Array(t.initData.buffer),initDataType:t.initDataType}}));t.b=v(i,U)}function U(t,e){return t.initDataType==e.initDataType&&E(t.initData,e.initData)}function B(t){this.c=Math.exp(Math.log(.5)/t),this.a=this.b=0}function K(t){return t.b/(1-Math.pow(t.c,t.a))}function q(t){var e,i=new CustomEvent(t.type,{detail:t.detail,bubbles:!!t.bubbles});for(e in t)e in i||(i[e]=t[e]);return i}function F(t){return new CustomEvent("error",{detail:t,bubbles:!0})}function V(t,e,i){return H(e),H(i),i==e||t>=Qr&&i==e.split("-")[0]||t>=Zr&&i.split("-")[0]==e.split("-")[0]}function H(t){t=t.toLowerCase().split("-");var e=ts[t[0]];return e&&(t[0]=e),t.join("-")}function z(t){this.ya=new _,this.v=t}function G(t,e){e.currentTarget=t;for(var i=t.ya.get(e.type)||[],n=0;n<i.length;++n){var r=i[n];try{r.handleEvent?r.handleEvent(e):r.call(t,e)}catch(s){}}return t.v&&e.bubbles&&G(t.v,e),e.defaultPrevented}function Y(){z.call(this,null),this.a=new B(3),this.c=new B(10),this.b=0}function W(t){var e=es;this.b=t,this.c=e==is,this.a=0}function J(t){return t.a<t.b.byteLength}function $(t){var e=t.b.getUint8(t.a);return t.a+=1,e}function X(t){var e=t.b.getUint32(t.a,t.c);return t.a+=4,e}function Q(t){var e,i;if(t.c?(e=t.b.getUint32(t.a,!0),i=t.b.getUint32(t.a+4,!0)):(i=t.b.getUint32(t.a,!1),e=t.b.getUint32(t.a+4,!1)),2097151<i)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");return t.a+=8,i*Math.pow(2,32)+e}function Z(t){if(t.a+16>t.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var e=new Uint8Array(t.b.buffer,t.a,16);return t.a+=16,e}function tt(t,e){if(t.a+e>t.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");t.a+=e}function et(){this.g=new h,this.f=!1,this.a=null,this.b=[],this.c=null}function it(t,e){if(t.f)throw Error("Cannot append to a running task!");t.b.push(e)}function nt(t,e){var i,n=t.b[0](e);n?(i=n[0],t.c=n[1]):(i=Promise.resolve(),t.c=null),i.then(u(t,function(t){this.a?(this.b=[],this.c=null,rt(this)):(this.b.shift(),this.b.length?nt(this,t):(this.g.resolve(t),this.c=null))}))["catch"](u(t,function(t){this.b=[],this.c=null,this.a?rt(this):this.g.reject(t)}))}function rt(e){var i=Error("Task aborted.");i.type="aborted",e.g.reject(i),t.setTimeout(function(){this.a.resolve(),this.a=null}.bind(e),5)}function st(){this.a=new _}function at(t,e,i,n){e=new ht(e,i,n),t.a.push(i,e)}function ot(t){for(var e=M(t.a),i=0;i<e.length;++i)e[i].sa();t.a.a={}}function ht(t,e,i){this.target=t,this.type=e,this.a=i,this.target.addEventListener(e,i,!1)}function ut(t,e){z.call(this,e),this.a=null,this.h=t}function lt(e){if(!t.indexedDB)return e=Error("Persistant storage requires IndexedDB support."),e.type="storage",Promise.reject(e);if(e.a)return e=Error("A database connection is already open."),e.type="storage",Promise.reject(e);var i=new h,n=t.indexedDB.open("content_database",1);return n.onupgradeneeded=u(e,function(t){this.a=t.target.result,ft(this,"group_store",{keyPath:"group_id"}),ft(this,"stream_index_store",{keyPath:"stream_id"}),t=ft(this,"content_store",{autoIncrement:"true"}),t.createIndex("segment",["stream_id","segment_id"],{unique:!0}),t.createIndex("stream","stream_id",{unique:!1})}),n.onsuccess=u(e,function(t){this.a=t.target.result,i.resolve()}),n.onerror=function(){i.reject(n.error)},i}function ct(t){t.a&&(t.a.close(),t.a=null)}function ft(t,e,i){return t.a.objectStoreNames.contains(e)&&t.a.deleteObjectStore(e),t.a.createObjectStore(e,i)}function pt(t){return bt(t,"content_store")}function dt(t){return bt(t,"stream_index_store")}function yt(t){return bt(t,"group_store")}function bt(t,e){return t.a.transaction([e],t.h).objectStore(e)}function vt(t,e){var i=new h,n=t.get(e);return n.onerror=function(){i.reject(n.error)},n.onsuccess=function(){if(n.result)i.resolve(n.result);else{var t=Error("Item not found.");t.type="storage",i.reject(t)}},i}function gt(){ut.call(this,"readonly",null)}function mt(t){var e=new h,i=[],n=yt(t).openCursor();return n.onerror=function(){e.reject(n.error)},n.onsuccess=function(t){(t=t.target.result)?(i.push(t.key),t["continue"]()):e.resolve(i)},e}function wt(t,e){return vt(yt(t),e).then(u(t,function(t){return t.session_ids=v(t.session_ids),t.hasOwnProperty("duration")||t.hasOwnProperty("key_system")?Promise.resolve(t):Tt(this,t.stream_ids[0]).then(function(e){return t.duration=e.duration,t.key_system=e.key_system,t.license_server=e.license_server,t.with_credentials=e.with_credentials,t.distinctive_identifier=e.distinctive_identifier,t.audio_robustness=e.audio_robustness,t.video_robustness=e.video_robustness,Promise.resolve(t)})}))}function Tt(t,e){return vt(dt(t),e)}function Et(t,e,i){return vt(pt(t).index("segment"),[e,i]).then(function(t){return Promise.resolve(t.content)})}function kt(t,e,i){MediaSource.isTypeSupported(e),e=t.addSourceBuffer(e),this.i=t,this.c=e,this.l=i,this.j=new st,this.g=null,this.b=[],this.w=0,this.f=this.a=null,this.s=0,at(this.j,this.c,"updateend",this.B.bind(this))}function Pt(t,e){for(var i=t.c.buffered,n=0;n<i.length;++n){var r=i.start(n)-ns,s=i.end(n)+ns;if(e>=r&&e<=s)return i.end(n)-e}return 0}function St(t,e,i,n){if(t.a)return t=Error("Cannot fetch ("+t.v+"): previous operation not complete."),t.type="stream",Promise.reject(t);t.a=new et,i!=t.c.timestampOffset&&(t.c.timestampOffset=i),"idb"!=e.url.b[0].P||t.g||(t.g=new gt,it(t.a,function(){return[lt(this.g)]}.bind(t))),n&&it(t.a,function(){return[It(this,n),this.h.bind(this)]}.bind(t)),it(t.a,function(){var t=e.a?e.a-e.b:1,i=new Le;return i.a=3,i.h=1e3*t,i.c=1e3*this.s,i.i=this.g,[ze(e.url,i,this.l),Ve.prototype.g.bind(e.url)]}.bind(t)),it(t.a,u(t,function(t){return this.l.getBandwidth(),[It(this,t),this.h.bind(this)]}));var r=0==t.c.buffered.length&&0==t.b.length,s=null;return it(t.a,function(){if(0==this.c.buffered.length){var t=Error("Failed to buffer segment ("+this.v+").");return t.type="stream",[Promise.reject(t)]}r&&(t=e.b,s=this.c.buffered.start(0)-t),t=$e(this.b,e.b),0<=t?this.b.splice(t+1,0,e):this.b.push(e)}.bind(t)),Mt(t).then(function(){return Promise.resolve(s)}.bind(t))}function jt(t){return t.a?(t=Error("Cannot clear ("+t.v+"): previous operation not complete."),t.type="stream",Promise.reject(t)):(t.a=new et,it(t.a,function(){var t;t:if(0==this.c.buffered.length)t=Promise.resolve();else{try{this.c.remove(0,this.i.duration)}catch(e){t=Promise.reject(e);break t}this.b=[],t=this.f=new h}return[t,this.h.bind(this)]}.bind(t)),Mt(t))}function At(t,e){if(t.a){var i=Error("Cannot clearAfter ("+t.v+"): previous operation not complete.");return i.type="stream",Promise.reject(i)}return t.a=new et,it(t.a,function(){return[Nt(this,e),this.h.bind(this)]}.bind(t)),Mt(t)}function _t(t){return t.a?(t=t.a,t.a?t=t.a:t.f?(t.c&&t.c(),t.a=new h,t=t.a):(t.f=!0,t=Promise.resolve())):t=Promise.resolve(),t}function Mt(t){return t.a.start(),t.a.g.then(u(t,function(){this.a=null}))["catch"](u(t,function(t){return this.a=null,Promise.reject(t)}))}function It(t,e){try{t.c.appendBuffer(e)}catch(i){return Promise.reject(i)}return t.f=new h,t.f}function Nt(t,e){if(0==t.c.buffered.length)return Promise.resolve();var i=$e(t.b,e);if(-1==i||i==t.b.length-1)return Promise.resolve();try{t.c.remove(t.b[i+1].b,t.i.duration)}catch(n){return Promise.reject(n)}return t.b=t.b.slice(0,i+1),t.f=new h,t.f}function Rt(t){var e=console[t];e?e.bind||(console[t]=function(){e.apply(console,arguments)}):console[t]=function(){}}function Ct(){this.fontSize="100%",this.fontColor=rs,this.fontOpacity=as,this.backgroundColor=ss,this.backgroundOpacity=as,this.fontEdge=os}function Dt(t){var e=[];e.push("font-size: "+t.fontSize),e.push("color: "+xt(t.fontColor,t.fontOpacity)),e.push("background-color: "+xt(t.backgroundColor,t.backgroundOpacity));for(var i=[],n=0;n<t.fontEdge.length;++n){var r=t.fontEdge[n].slice(3,6);i.push(xt(t.fontEdge[n].slice(0,3),t.fontOpacity)+" "+r.join("px ")+"px")}return e.push("text-shadow: "+i.join(",")),e.join("; ")}function xt(t,e){return"rgba("+t.concat(e).join(",")+")"}function Ot(t){this.systemIds=[],this.cencKeyIds=[],this.a=[],t=new W(new DataView(t.buffer));try{for(;J(t);){var e=t.a,i=X(t),n=X(t);if(1==i?i=Q(t):0==i&&(i=t.b.byteLength-e),1886614376!=n)tt(t,i-(t.a-e));else{var r=$(t);if(1<r)tt(t,i-(t.a-e));else{tt(t,3);var s=T(Z(t)),a=[];if(0<r)for(var o=X(t),h=0;h<o;++h){var u=T(Z(t));a.push(u)}var l=X(t);tt(t,l),this.cencKeyIds.push.apply(this.cencKeyIds,a),this.systemIds.push(s),this.a.push({start:e,end:t.a-1}),t.a!=e+i&&tt(t,i-(t.a-e))}}}}catch(c){}}function Lt(t){us[t]={na:hs(),end:NaN}}function Ut(t){(t=us[t])&&(t.end=hs())}function Bt(t){return(t=us[t])&&t.end?t.end-t.na:NaN}function Kt(t){if(this.c=[],this.b=[],this.ba=ls,t)try{t(this.W.bind(this),this.a.bind(this))}catch(e){this.a(e)}}function qt(){t.Promise||(t.Promise=Kt,t.Promise.resolve=Ft,t.Promise.reject=Vt,t.Promise.all=Ht,t.Promise.race=zt,t.setImmediate?(Wt=function(e){return t.setImmediate(e)},Jt=function(e){return t.clearImmediate(e)}):(Wt=function(e){return t.setTimeout(e,0)},Jt=function(e){return t.clearTimeout(e)}))}function Ft(t){var e=new Kt;return e.W(t),e}function Vt(t){var e=new Kt;return e.a(t),e}function Ht(t){function e(t,e,i){t.ba==ls&&(r[e]=i,n++,n==r.length&&t.W(r))}var i=new Kt;if(!t.length)return i.W([]),i;for(var n=0,r=Array(t.length),s=i.a.bind(i),a=0;a<t.length;++a)t[a]&&t[a].then?t[a].then(e.bind(null,i,a),s):e(i,a,t[a]);return i}function zt(t){for(var e=new Kt,i=e.W.bind(e),n=e.a.bind(e),r=0;r<t.length;++r)t[r]&&t[r].then?t[r].then(i,n):i(t[r]);return e}function Gt(t,e,i){fs.push(function(){if(i&&"function"==typeof i){try{var t=i(this.wa)}catch(n){return void e.a(n)}t instanceof Kt?t==e?e.a(new TypeError("Chaining cycle detected")):t.then(e.W.bind(e),e.a.bind(e)):e.W(t)}else 1==this.ba?e.W(this.wa):e.a(this.wa)}.bind(t)),null==cs&&(cs=Wt(Yt))}function Yt(){for(;fs.length;){null!=cs&&(Jt(cs),cs=null);var t=fs;fs=[];for(var e=0;e<t.length;++e)t[e]()}}function Wt(){return 0}function Jt(){}function $t(t,e){try{var i=new Xt(t,e);return Promise.resolve(i)}catch(n){return Promise.reject(n)}}function Xt(t,e){this.keySystem=t;for(var i=!1,n=0;n<e.length;++n){var r=e[n],s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"]},a=!1;if(r.audioCapabilities)for(var o=0;o<r.audioCapabilities.length;++o){var h=r.audioCapabilities[o];if(h.contentType){var a=!0,u=h.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,u)&&(s.audioCapabilities.push(h),i=!0)}}if(r.videoCapabilities)for(o=0;o<r.videoCapabilities.length;++o)h=r.videoCapabilities[o],h.contentType&&(a=!0,u=h.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,u)&&(s.videoCapabilities.push(h),i=!0));if(a||(i=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==r.persistentState&&(s.persistentState="required",s.sessionTypes=["persistent-license"]),i)return void(this.a=s)}throw i=Error("Unsupported keySystem"),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function Qt(t){var e=this.mediaKeys;return e&&e!=t&&te(e,null),delete this.mediaKeys,(this.mediaKeys=t)?te(t,this):Promise.resolve()}function Zt(t){this.a=new MSMediaKeys(t),this.b=new st}function te(t,e){function i(){e.msSetMediaKeys(n.a),e.removeEventListener("loadedmetadata",i)}if(ot(t.b),!e)return Promise.resolve();at(t.b,e,"msneedkey",ie);var n=t;try{return 1<=e.readyState?e.msSetMediaKeys(t.a):e.addEventListener("loadedmetadata",i),Promise.resolve()}catch(r){return Promise.reject(r)}}function ee(t){z.call(this,null),this.c=null,this.g=t,this.b=this.a=null,this.f=new st,this.sessionId="",this.expiration=NaN,this.closed=new h,this.keyStatuses=new se}function ie(t){var e=t.initData;if(e){var i=new Ot(e);if(1>=i.a.length)t=e;else{var n=[];for(t=0;t<i.a.length;t++)n.push(e.subarray(i.a[t].start,i.a[t].end+1));for(e=v(n,ne),t=i=0;t<e.length;t++)i+=e[t].length;for(i=new Uint8Array(i),t=n=0;t<e.length;t++)i.set(e[t],n),n+=e[t].length;t=i}}else t=e;t=q({type:"encrypted",initDataType:"cenc",initData:t}),this.dispatchEvent(t)}function ne(t,e){return E(t,e)}function re(t,e){t.keyStatuses.Ma(e);var i=q({type:"keystatuseschange"});t.dispatchEvent(i)}function se(){this.size=0,this.a=void 0}function ae(){var e="CustomEvent"in t;if(e)try{new CustomEvent("")}catch(i){e=!1}e||(t.CustomEvent=oe)}function oe(t,e){var i=document.createEvent("CustomEvent"),n=e||{bubbles:!1,cancelable:!1,detail:null};return i.initCustomEvent(t,!!n.bubbles,!!n.cancelable,n.detail),i}function he(){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in t&&(t.getVideoPlaybackQuality=ue)}function ue(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function le(){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,t=Document.prototype,t.exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitExitFullscreen,"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),document.addEventListener("webkitfullscreenchange",ce),document.addEventListener("webkitfullscreenerror",ce),document.addEventListener("mozfullscreenchange",ce),document.addEventListener("mozfullscreenerror",ce),document.addEventListener("MSFullscreenChange",ce),document.addEventListener("MSFullscreenError",ce)}function ce(t){var e=t.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),e=new Event(e,t);t.target.dispatchEvent(e)}function fe(){return Promise.reject(Error("The key system specified is not supported."))}function pe(t){return null==t?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function de(){throw new TypeError("Illegal constructor.")}function ye(){throw new TypeError("Illegal constructor.")}function be(t,e){try{var i=new ge(t,e);return Promise.resolve(i)}catch(n){return Promise.reject(n)}}function ve(t){var e=this.mediaKeys;return e&&e!=t&&we(e,null),delete this.mediaKeys,(this.mediaKeys=t)&&we(t,this),Promise.resolve()}function ge(t,e){this.a=this.keySystem=t;var i=!0;"org.w3.clearkey"==t&&(this.a="webkit-org.w3.clearkey",i=!1);var n,r=!1;n=document.getElementsByTagName("video"),n=n.length?n[0]:document.createElement("video");for(var s=0;s<e.length;++s){var a=e[s],o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:a.initDataTypes,sessionTypes:["temporary"]},h=!1;if(a.audioCapabilities)for(var u=0;u<a.audioCapabilities.length;++u){var l=a.audioCapabilities[u];l.contentType&&(h=!0,n.canPlayType(l.contentType.split(";")[0],this.a)&&(o.audioCapabilities.push(l),r=!0))}if(a.videoCapabilities)for(u=0;u<a.videoCapabilities.length;++u)l=a.videoCapabilities[u],l.contentType&&(h=!0,n.canPlayType(l.contentType,this.a)&&(o.videoCapabilities.push(l),r=!0));if(h||(r=n.canPlayType("video/mp4",this.a)||n.canPlayType("video/webm",this.a)),"required"==a.persistentState&&(i?(o.persistentState="required",o.sessionTypes=["persistent-license"]):r=!1),r)return void(this.b=o)}throw i="Unsupported keySystem","org.w3.clearkey"!=t&&"com.widevine.alpha"!=t||(i="None of the requested configurations were supported."),i=Error(i),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function me(t){this.g=t,this.b=null,this.a=new st,this.c=[],this.f={}}function we(t,e){t.b=e,ot(t.a),e&&(at(t.a,e,"webkitneedkey",t.Ob.bind(t)),at(t.a,e,"webkitkeymessage",t.Nb.bind(t)),at(t.a,e,"webkitkeyadded",t.Lb.bind(t)),at(t.a,e,"webkitkeyerror",t.Mb.bind(t)))}function Te(t,e){var i=t.f[e];return i?i:(i=t.c.shift())?(i.sessionId=e,t.f[e]=i):null}function Ee(t,e,i){z.call(this,null),this.f=t,this.h=!1,this.a=this.b=null,this.c=e,this.g=i,this.sessionId="",this.expiration=NaN,this.closed=new h,this.keyStatuses=new Se}function ke(t,e,i){if(t.h)return Promise.reject(Error("The session is already initialized."));t.h=!0;var n;try{if("persistent-license"==t.g)if(i)n=m("LOAD_SESSION|"+i);else{var r=new Uint8Array(e);n=m("PERSISTENT|"+g(r))}else n=new Uint8Array(e)}catch(s){return Promise.reject(s)}t.b=new h;try{t.f.webkitGenerateKeyRequest(t.c,n)}catch(a){if("InvalidStateError"!=a.name)return t.b=null,Promise.reject(a);setTimeout(function(){try{this.f.webkitGenerateKeyRequest(this.c,n)}catch(t){this.b.reject(t),this.b=null}}.bind(t),10)}return t.b}function Pe(t,e){t.keyStatuses.Ma(e);var i=q({type:"keystatuseschange"});t.dispatchEvent(i)}function Se(){this.size=0,this.a=void 0}function je(){Navigator.prototype.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?(ds=new Uint8Array([0]).buffer,Navigator.prototype.requestMediaKeySystemAccess=be,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=ve,t.MediaKeys=me,t.MediaKeySystemAccess=ge):t.MSMediaKeys?(ps=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Qt,t.MediaKeys=Zt,t.MediaKeySystemAccess=Xt,Navigator.prototype.requestMediaKeySystemAccess=$t):(Navigator.prototype.requestMediaKeySystemAccess=fe,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=pe,t.MediaKeys=de,t.MediaKeySystemAccess=ye))}function Ae(t){var e;t instanceof Ae?(_e(this,t.P),this.ca=t.ca,this.S=t.S,Me(this,t.ia),this.O=t.O,Ie(this,t.a.clone()),this.aa=t.aa):t&&(e=String(t).match(ys))?(_e(this,e[1]||"",!0),this.ca=Ne(e[2]||""),this.S=Ne(e[3]||"",!0),Me(this,e[4]),this.O=Ne(e[5]||"",!0),Ie(this,e[6]||"",!0),this.aa=Ne(e[7]||"")):this.a=new De(null)}function _e(t,e,i){t.P=i?Ne(e,!0):e,t.P&&(t.P=t.P.replace(/:$/,""))}function Me(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.ia=e}else t.ia=null}function Ie(t,e,i){e instanceof De?t.a=e:(i||(e=Re(e,ms)),t.a=new De(e))}function Ne(t,e){return t?e?decodeURI(t):decodeURIComponent(t):""}function Re(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,Ce),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ce(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(15&t).toString(16)}function De(t){this.b=t||null}function xe(t,e,i){if(!t.a&&(t.a={},t.c=0,t.b))for(var n=t.b.split("&"),r=0;r<n.length;r++){var s=n[r].indexOf("="),a=null,o=null;0<=s?(a=n[r].substring(0,s),o=n[r].substring(s+1)):a=n[r],a=decodeURIComponent(a.replace(/\+/g," ")),o=o||"",xe(t,a,decodeURIComponent(o.replace(/\+/g," ")))}t.b=null,(n=t.a.hasOwnProperty(e)&&t.a[e])||(t.a[e]=n=[]),n.push(i),t.c++}function Oe(t,e){this.url=t,this.b=e||new Le,this.g=this.i=this.h=0,this.a=null,this.c=new h,this.f=null}function Le(){this.body=null,this.a=1,this.h=1e3,this.c=0,this.method="GET",this.f="arraybuffer",this.b={},this.g=this.j=!1,this.i=null}function Ue(t){Be(t),t.b.body=null,t.c.destroy(),t.c=null,t.f=null}function Be(t){t.a&&(t.a.onload=null,t.a.onreadystatechange=null,t.a.onerror=null,t.a.ontimeout=null),t.a=null}function Ke(t){var e=t.url.split("/");return Et(t.b.i,parseInt(e[2],10),parseInt(e[3],10)).then(u(t,function(t){var e=JSON.parse(JSON.stringify(new XMLHttpRequest));return e.response=t,t=this.c,t.resolve(e),Ue(this),t}))["catch"](u(t,function(t){return Ue(this),Promise.reject(t)}))}function qe(t,e,i){return e=Error(e),e.type=i,e.status=t.a.status,e.url=t.url,e.method=t.b.method,e.body=t.b.body,e.Xb=t.a,e}function Fe(e){Be(e),t.setTimeout(e.rb.bind(e),e.g*(1+.5*(2*Math.random()-1))),e.g*=2;
}function Ve(t,e,i,n){this.b=e,this.f=i||0,this.i=null!=n?n:null,this.c=this.a=null,this.j=t,this.h=null}function He(t,e){return t&&0!==t.length?t.map(function(t){return t.resolve(e)}):[e]}function ze(t,e,i){return t.a?t.a:(e=e||new Le,(t.f||t.i)&&(e.b.Range="bytes="+(t.f+"-"+(null!=t.i?t.i:""))),t.a=Ge(t,0,e,i),t.a)}function Ge(t,e,i,n){var r=t.b[e].toString();return t.j&&(r=t.j(r,i.b)||r),t.c=new Oe(r,i),n&&(t.c.f=n),r=t.c.rb().then(u(t,function(t){return this.h=this.c=this.a=null,this.h=t.a?new Ae(t.a):this.b[e],Promise.resolve(t.response)})),r=r["catch"](u(t,function(t){return this.a&&e+1<this.b.length?this.a=Ge(this,e+1,i,n):(this.a=this.c=null,Promise.reject(t))}))}function Ye(t,e){this.a=t,this.b=e||null}function We(t,e,i){this.b=t,this.a=e,this.url=i}function Je(t,e,i){return new We(e,i,t.url)}function $e(t,e){for(var i=t.length-1;0<=i;--i){var n=t[i];if(e>=n.b&&(null==n.a||e<n.a))return i}return-1}function Xe(t,e){return t.map(function(t){return Je(t,t.b+e,null!=t.a?t.a+e:null)})}function Qe(){}function Ze(){}function ti(t){this.o=t,this.i=0}function ei(t){if(0==t.o.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return t.o[0]}function ii(t,e){if(t.i!=e.i&&(e=new ti(Xe(e.o,t.i-e.i))),0==t.length())t.o=e.o.slice(0);else if(0!=e.length()&&null!=t.A().a&&!(null!=e.A().a&&e.A().a<t.A().a)){if(t.A().a<=ei(e).b)var i=Je(t.A(),t.A().b,ei(e).b),i=t.o.slice(0,-1).concat([i]);else{var n;for(n=0;n<t.o.length&&!(t.o[n].a>=ei(e).b);++n);t.o[n].b<ei(e).b?(i=Je(t.o[n],t.o[n].b,ei(e).b),i=t.o.slice(0,n).concat([i])):(ei(t).b>ei(e).b||ei(e),i=t.o.slice(0,n))}t.o=i.concat(e.o)}}function ni(t){this.b=t,this.a=null}function ri(t){this.b=t,this.a=null}function si(){this.C=Es++,this.id=this.H=this.I=null,this.c=0,this.height=this.width=this.bandwidth=null,this.b=this.a="",this.f=[],this.N=!1,this.J=!0}function ai(t){var e=t.a||"";return t.b&&(e+='; codecs="'+t.b+'"'),e}function oi(){this.C=ks++,this.id=null,this.contentType=this.lang="",this.b=!1,this.m=[],this.a=[]}function hi(t){for(var e=[],i=0;i<t.a.length;++i){var n=new ci;n.id=t.C,n.a=t.a[i],n.contentType=t.contentType,n.b=t.m.length?ai(t.m[0]):"",e.push(n)}return e}function ui(){this.id=null,this.start=0,this.b=null,this.a=[]}function li(){this.b=!1,this.h=this.g=this.f=null,this.c=0,this.a=[]}function ci(){this.id=0,this.a=null,this.b=this.contentType=""}function fi(t,e){z.call(this,t),this.b=e,this.g=!0,this.h=this.f=null,this.c=new h,this.a=null}function pi(t,e,i,n,r){z.call(this,t),this.c=e,this.a=new kt(i,n,r),this.w=this.G=this.b=null,this.K=!1,this.g=null,this.l=!1,this.i=null,this.s=!1,this.h=new h,this.j=this.f=!1,this.B=0,this.L=15,this.D=!1}function di(t,e,i){t.b&&!t.l&&(t.l=!0,wi(t),_t(t.a).then(u(t,function(){var t=this.c.currentTime;return!e&&0<Pt(this.a,t)&&0<=$e(this.a.b,t)?Promise.resolve():i?At(this.a,this.c.currentTime+i):(this.D=!0,jt(this.a))})).then(u(t,function(){this.l=!1,mi(this,0)}))["catch"](u(t,function(t){this.l=!1,this.f?(t=F(t),this.dispatchEvent(t)):this.h.reject(t)})))}function yi(t,e,i){t=t.a;var n=t.b.length;return t=0<n?t.b[n-1]:null,null!=t?null!=t.a?i.la(t.a):null:i.la(e)||(i.length()?i.A():null)}function bi(t){if(!t.s&&null!=t.i){t.s=!0;var e=t.a,i=t.i,n=i-e.w;0!=n&&(e.b=Xe(e.b,n),e.w=i),t.h.resolve(t.i)}}function vi(t,e){var i;i=e.a.split("/")[0],i=q({type:"adaptation",bubbles:!0,contentType:i,size:"video"!=i?null:{width:e.width,height:e.height},bandwidth:e.bandwidth}),t.dispatchEvent(i)}function gi(t){var e=q({type:"ended"});t.dispatchEvent(e)}function mi(e,i){e.g=t.setTimeout(e.Kb.bind(e),i)}function wi(e){null!=e.g&&(t.clearTimeout(e.g),e.g=null)}function Ti(){this.streamStats=null,this.droppedFrames=this.decodedFrames=NaN,this.bufferingTime=this.playTime=this.estimatedBandwidth=0,this.playbackLatency=NaN,this.bufferingHistory=[],this.bandwidthHistory=[],this.streamHistory=[]}function Ei(t,e){var i=new ki(e);t.streamHistory.push(new Pi(i)),!i.videoHeight&&t.streamStats||(t.streamStats=i)}function ki(t){this.videoWidth=t.width,this.videoHeight=t.height,this.videoMimeType=t.a,this.videoBandwidth=t.bandwidth}function Pi(t){this.timestamp=R()/1e3,this.value=t}function Si(t,e,i,n,r,s){this.b=new Ve(null,[new Ae(t)]),this.a=new Le,this.a.body=e,this.a.method=i,this.a.a=3,this.a.j=n,this.a.c=1e3*(null!=s?s:0),t=r||{};for(var a in t)this.a.b[a]=t[a]}function ji(t){return ze(t.b,t.a).then(function(t){return Promise.resolve(new Uint8Array(t))})}function Ai(t,e,i){z.call(this,t),this.h=e,this.b=i,this.a=this.i=null,this.l=new st,this.c=[],this.f=[],this.s=0,this.g=new h,this.j=null,this.w=0}function _i(e,i){return null==e.j&&(e.j=t.setTimeout(function(){var t=Error("Timeout waiting for sessions.");t.type="storage",this.g.reject(t)}.bind(e),i)),e.g}function Mi(t){return Promise.all(t.f.map(function(t){return t.remove()}))}function Ii(t,e,i){for(var n in e)i=i["catch"](function(t,e){return navigator.requestMediaKeySystemAccess(t,[e])}.bind(null,n,e[n]));return t.b.ha()&&(i=i["catch"](function(){throw Error("Either none of the requested key systems are supported or none of the requested key systems support persistent state.")})),i}function Ni(t){return t.h?t.i?t.h.setMediaKeys(t.i).then(u(t,function(){return this.h?this.a.c?this.i.setServerCertificate(this.a.c):Promise.resolve():Ri()})).then(u(t,function(){if(!this.h)return Ri();if(0<this.b.ua().length)Ci(this);else{for(var t=0;t<this.a.b.length;++t){var e=this.a.b[t];this.B({type:"encrypted",initDataType:e.initDataType,initData:e.initData})}0==this.a.b.length&&at(this.l,this.h,"encrypted",this.B.bind(this))}})):Promise.resolve():Ri()}function Ri(){var t=Error("EmeManager destroyed");return t.type="destroy",Promise.reject(t)}function Ci(t){for(var e=t.b.ua(),i=0;i<e.length;++i){var n=Di(t),r=n.load(e[i]);t.f.push(n),r.then(u(t,function(){this.s++,this.s>=this.f.length&&this.g.resolve()}))["catch"](u(t,function(t){t=F(t),this.dispatchEvent(t)}))}}function Di(t){var e=null;if(t.b.ha())try{e=t.i.createSession("persistent-license")}catch(i){throw Error("Persistent licenses are not supported by this key system or platform.")}else e=t.i.createSession();return at(t.l,e,"message",t.G.bind(t)),at(t.l,e,"keystatuseschange",t.F.bind(t)),e}function xi(t,e,i,n){n=Oi(i,n),ji(new Si(n.url,n.body,n.method,i.i,n.headers,t.w)).then(u(t,function(t){return i.l&&(t=i.l(t)),e.update(t)})).then(u(t,function(){var t=q({type:"sessionReady",detail:e});this.dispatchEvent(t),this.s++,this.s>=this.f.length&&this.g.resolve()}))["catch"](u(t,function(t){t.La=e,t=F(t),this.dispatchEvent(t)}))}function Oi(e,i){var n={url:e.h,body:i.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===e.a){for(var r=String.fromCharCode.apply(null,new Uint16Array(n.body)),r=(new DOMParser).parseFromString(r,"application/xml"),s=r.getElementsByTagName("name"),a=r.getElementsByTagName("value"),o=0;o<s.length;o++)n.headers[s[o].childNodes[0].nodeValue]=a[o].childNodes[0].nodeValue;n.body=t.atob(r.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!e.s)return n;if(e.s(n),n.url=p(n,"url"),null==n.url)throw Error("'url' cannot be null.");if(!(n.body instanceof ArrayBuffer||"string"==typeof n.body||null==n.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");if(n.method=p(n,"method"),"GET"!=n.method&&"POST"!=n.method)throw Error("'method' must be either 'GET' or 'POST'.");if(n.headers=y(n,"headers",Object),null==n.headers)throw Error("'headers' cannot be null.");return n}function Li(t){z.call(this,null),this.a=t,this.b=null,this.f=new st,this.j=this.i=null,this.D=0,this.w=null,this.h=!1,this.g=new Ti,this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new r},this.l=1,this.F=null}function Ui(e){return"text/vtt"==e?!!t.VTTCue:MediaSource.isTypeSupported(e)}function Bi(){var t=Error("Player destroyed");return t.type="destroy",Promise.reject(t)}function Ki(e){e.j&&(t.clearTimeout(e.j),e.j=null)}function qi(e){Fi(e),e.w=t.setTimeout(e.L.bind(e),100)}function Fi(e){e.w&&(t.clearTimeout(e.w),e.w=null)}function Vi(t){Ut("buffering");var e=t.g;e.bufferingTime+=Bt("buffering")/1e3,t.h=!1,t.dispatchEvent(q({type:"bufferingEnd"}))}function Hi(t){for(var e=0;e<t.length;++e)for(var i=t[e],n=0;n<i.a.length;++n){for(var r=i.a[n],s=r,a=0;a<s.m.length;++a)Ui(ai(s.m[a]))||(s.m.splice(a,1),--a);0==r.m.length&&(i.a.splice(n,1),--n)}}function zi(t){for(var e=0;e<t.length;++e)for(var i=t[e],n=0;n<i.a.length;++n)i.a[n].m.sort(Gi)}function Gi(t,e){var i=t.bandwidth||Number.MAX_VALUE,n=e.bandwidth||Number.MAX_VALUE;return i<n?-1:i>n?1:0}function Yi(t){this.a=t}function Wi(t){function e(t,e){return t.concat(e)}var i=t.a.map(function(t){return t.a}).reduce(e,[]).map(function(t){return t.m}).reduce(e,[]);return t=i.map(function(t){return t.I.create()}),Promise.all(t).then(function(t){for(var e={},n=0;n<i.length;++n)e[i[n].C]=t[n];return Promise.resolve(e)})}function Ji(t,e,i,n,r){var s=new _;t.a.forEach(function(t,e){s.push(t.id||""+e,t)});var a=new _;for(e.a.forEach(function(t,e){a.push(t.id||""+e,t)}),t=N(s),e=0;e<t.length;++e){var o=t[e],h=s.get(o);1<h.length||(o=a.get(o))&&0!=o.length&&1==o.length&&($i(h[0],o[0],i,n,r),h[0].b=o[0].b)}}function $i(t,e,i,n,r){var s=new _;t.a.forEach(function(t,e){s.push(t.id||""+e,t)});var a=new _;for(e.a.forEach(function(t,e){a.push(t.id||""+e,t)}),t=N(s),e=0;e<t.length;++e){var o=t[e],h=s.get(o);1<h.length||(o=a.get(o))&&0!=o.length&&1==o.length&&Xi(h[0],o[0],i,n,r)}}function Xi(t,e,i,n,r){var s=new _;t.m.forEach(function(t,e){s.push(t.id||""+e,t)});var a=new _;e.m.forEach(function(t,e){a.push(t.id||""+e,t)}),e={};for(var o=N(s),h=0;h<o.length;++h){var u=o[h];e[u]=u;var l=s.get(u);1<l.length||((u=a.get(u))&&0!=u.length?1==u.length&&(Qi(l[0],u[0],i,n),l[0].H=u[0].H,u[0].H=null,l[0].c=u[0].c):(r.push(l[0]),t.m.splice(t.m.indexOf(l[0]),1)))}for(o=N(a),h=0;h<o.length;++h)u=o[h],e[u]||(e[u]=u,u=a.get(u),t.m.push(u[0]))}function Qi(t,e,i,n){t=i[t.C],e=n[e.C],t.length(),t.Ha(e)&&t.length()}function Zi(){this.a=this.b=null,this.f=new st,this.c=Number.POSITIVE_INFINITY,this.i=!0,this.g=!1}function tn(t){var e=t.a.ma();if(0==e.length)return null;e.sort(a);var i;t:{i=t.a.pa();for(var n=0;n<i.length;++n)if(i[n].active){i=i[n];break t}i=null}i=i?i.bandwidth:0,t=t.b.getBandwidth();for(var n=e[0],r=0;r<e.length;++r){var s=e[r],o=r+1<e.length?e[r+1]:{bandwidth:Number.POSITIVE_INFINITY};if(s.bandwidth&&(o=(o.bandwidth+i)/.85,t>=(s.bandwidth+i)/.95&&t<=o&&(n=s,n.active)))break}return n}function en(t,e,i){z.call(this,null),this.f=t,this.c=e,this.b=x(i),this.a=null}function nn(t,e,i){z.call(this,null),this.a=t,this.Z=e,this.i=new st,this.g=new MediaSource,this.f=null,this.da=0,this.b=new _,this.G=i,this.G.initialize(e,this),this.L=!1,this.K="en",this.fa=!1,this.U=null,this.B=new h,this.h=new r,this.D=null,this.Va=1,this.c={},this.ea=new h,this.Ta=0,this.Ua=15,this.w=null,this.Ra=this.Sa=!1,this.s={},this.$=this.Y=this.V=null,this.F={}}function rn(e,i){if(null!=e.a.f){var n=Math.max(e.a.f,3),n=Math.max(n-i,0);e.V=t.setTimeout(e.gb.bind(e,!1),1e3*n)}}function sn(t,e){var i=e.a.split("/")[0],n=t.c[i];if(n&&n.oa()==e){var r=t.b.get(e.a.split("/")[0]).map(function(t){return t.m}).reduce(function(t,e){return t.concat(e)},[]).filter(function(t){return t.N&&t.J});if(0==r.length)return i=Error("All usable streams have been removed from the manifest."),i.type="app",i=F(i),void t.dispatchEvent(i);t.s[i].Pa==e&&delete t.s[i],n.ra(r[0],!0),e.destroy()}e.destroy()}function an(t){if(t.h){for(var e=!1,i=0;i<t.a.a.length;++i)for(var n=t.a.a[i],r=0;r<n.a.length;++r){var s=n.a[r];if("video"==s.contentType)for(var a=0;a<s.m.length;++a){var o=s.m[a],h=o.J;o.J=!0,t.h.maxWidth&&o.width>t.h.maxWidth&&(o.J=!1),t.h.maxHeight&&o.height>t.h.maxHeight&&(o.J=!1),t.h.minHeight&&o.height<t.h.minHeight&&(o.J=!1),t.h.maxBandwidth&&o.bandwidth>t.h.maxBandwidth&&(o.J=!1),t.h.minBandwidth&&o.bandwidth<t.h.minBandwidth&&(o.J=!1),h!=o.J&&(e=!0)}}0!=M(t.b).length&&e&&(on(t),0<t.ma().length||(e=Error("The application has restricted all video tracks!"),e.type="app",e=F(e),t.dispatchEvent(e)))}}function on(t){var e=q({type:"trackschanged",bubbles:!0});t.dispatchEvent(e)}function hn(t,e,i,n,r){if(!t.b.a.hasOwnProperty(e)||!t.c[e])return!1;for(var s=t.b.get(e),a=0;a<s.length;++a)for(var o=s[a],h=0;h<o.m.length;++h){var u=o.m[h];if(u.C==i)return!(!u.N||!u.J)&&("text"==e||t.Ra?(Ei(t.U,u),t.c[e].ra(u,n,r),!0):(i=t.s[e],t.s[e]={Pa:u,Wa:null!=i&&i.Wa||n,Xa:null!=i&&i.Xa||r},!0))}return!1}function un(t,e){for(var i=0;2>=i;++i)for(var n=0;n<e.length;++n){var r=e[n];if(V(i,t.K,r.lang))return e.splice(n,1),void e.splice(0,0,r)}for(n=0;n<e.length;++n)if(r=e[n],r.b){e.splice(n,1),e.splice(0,0,r);break}}function ln(e){for(var i=[],n=["audio","video","text"],r=0;r<n.length;++r){var s=n[r];e.b.a.hasOwnProperty(s)&&i.push(e.b.get(s)[0])}for(var a=cn(e,i),r=0;r<n.length;++r)if(s=n[r],e.b.a.hasOwnProperty(s)&&!a[s])return e=Error("Unable to select an initial "+s+" stream: all "+s+" streams have been restricted (by the application or by the key system)."),e.type="stream",Promise.reject(e);return i=l(a).map(function(t){return t.I.create()}),Promise.all(i).then(u(e,function(t){return t.every(function(t){return t.length()})&&(t=wn(this,t))?fn(this,a)?(this.G.start(),dn(this,a,t),Promise.resolve()):(t=Error("Failed to create Stream objects."),t.type="stream",Promise.reject(t)):(t=Error("Some streams are not available."),t.type="stream",Promise.reject(t))}))["catch"](u(e,function(e){if("aborted"!=e.type)return Object.keys(this.c),this.a.b?(R()<this.a.h?(e=Math.max(this.a.h-Date.now()/1e3,3),this.V=t.setTimeout(this.gb.bind(this,!0),1e3*e)):rn(this,0),Promise.resolve()):Promise.reject(e)}))}function cn(t,e){for(var i={},n=0;n<e.length;++n){var r=e[n],s=null;if("video"==r.contentType){var a=t.G.getInitialVideoTrackId();if(null==a)continue;if(s=r.m.filter(function(t){return t.C==a}),0==s.length)continue;s=s[0]}else if("audio"==r.contentType){if(s=r.m.filter(function(t){return t.N&&t.J}),0==s.length)continue;s=r.m[Math.floor(s.length/2)]}else 0<r.m.length&&(s=r.m[0]);i[r.contentType]=s}return i}function fn(t,e){var i,n={};for(i in e){var r=e[i],r="text"==i?new fi(t,t.f):pn(t,r);if(!r)return l(n).forEach(function(t){t.destroy()}),!1;n[i]=r}return t.c=n,!0}function pn(t,e){var i=new pi(t,t.f,t.g,ai(e),t.Z);return i.F(t.F),i}function dn(t,e,i){t.Va=t.f.playbackRate,t.f.playbackRate=0,bn(t,i);var n;t.$&&t.$<=i.end&&t.$>=i.start?n=t.$:t.a.b?(n=i.end,t.Sa=!0):n=i.start,at(t.i,t.f,"seeking",t.Gb.bind(t)),t.f.currentTime!=n&&(t.f.currentTime=n,t.D=n),vn(t,i.start,i.end),i=[];for(var r in t.c){n=t.c[r],i.push(n.sb(t.ea)),at(t.i,n,"ended",t.Hb.bind(t));var s=e[r];Ei(t.U,s),n.ra(s,!1)}Promise.all(i).then(t.tb.bind(t))["catch"](u(t,function(t){"destroy"!=t.type&&(t=F(t),this.dispatchEvent(t))})),t.Na(t.fa)}function yn(t,e,i){(e=wn(t,e))&&(bn(t,e),vn(t,e.start,e.end)),0!=i&&(i=t.f.currentTime+i,t.f.currentTime=i,t.D=i),t.Sa&&e&&(t.f.currentTime=e.end),t.f.playbackRate=t.Va,t.a.b&&null!=t.a.f&&rn(t,0),Tn(t),t.ea.resolve()}function bn(t,e){if(t.a.b)isNaN(t.g.duration)&&(t.g.duration=e.end+2592e3);else if(isNaN(t.g.duration)||e.end>t.g.duration){t.g.duration=e.end;for(var i=0;i<t.g.sourceBuffers.length;++i)t.g.sourceBuffers[i].appendWindowEnd=e.end}}function vn(t,e,i){e=q({type:"seekrangechanged",bubbles:!0,start:e,end:i}),t.dispatchEvent(e)}function gn(t,e,i,n){if(e>=i-.01)return!1;if(e=0,t.a.b){e=.5;for(var r in t.c)if(!t.c[r].kb(i+e)){e=t.a.c;break}}return t.f.currentTime=Math.min(i+e,n),!0}function mn(t){return l(t.c).map(function(t){return t.bb()}).filter(function(t){return null!=t})}function wn(t,e){for(var i=0,n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=0;s<e.length;++s){var a=e[s].Ea(),i=Math.max(i,a.start);null!=a.end&&(n=Math.min(n,a.end)),e[s].length()&&(r=Math.min(r,e[s].A().a))}if(n==Number.POSITIVE_INFINITY){if(n=t.a.a[0],!n.b)return null;n=(n.start||0)+n.b}return t.a.b&&(n=Math.max(n-t.a.c,i)),i>n?null:{start:i,end:n,A:r}}function Tn(e){e.a.b&&(e.Y=t.setTimeout(e.Jb.bind(e),1e3))}function En(t){for(var e in t.c)t.c[e].F(t.F)}function kn(t,e){ut.call(this,"readwrite",e),this.j=t,this.b=0}function Pn(t,e,i,n,r){for(var s=[],a=[],o=0,l=0,c=[],f=e.map(function(t){return t.I.create()}),f=Promise.all(f),p=e.map(function(t){return t.H.create()}),p=Promise.all(p),f=Promise.all([f,p]).then(function(t){s=t[0],a=t[1],o=s.reduce(function(t,e){return t+e.length()},0)}),p=0;p<e.length;++p)f=f.then(function(t){return jn(this,e[t],s[t],a[t],o,l)}.bind(t,p)),f=f.then(function(t,e){l+=s[t].length(),c.push(e)}.bind(t,p));return f.then(u(t,function(){return An(yt(this))})).then(u(t,function(t){var e=new h;i=v(i);var s={group_id:t,stream_ids:c,session_ids:i,duration:n,key_system:r.a,license_server:r.h,with_credentials:r.i,distinctive_identifier:r.g,audio_robustness:r.f,video_robustness:r.j},a=yt(this).put(s);return a.onsuccess=function(){e.resolve(t)},a.onerror=function(){e.reject(a.error)},e}))}function Sn(t,e){return vt(yt(t),e).then(u(t,function(t){var i,n=[];for(i in t.stream_ids)n.push(Mn(this,t.stream_ids[i]));return t=yt(this),n.push(t["delete"](e)),Promise.all(n)}))}function jn(t,e,i,n,r,s){var a=[An(dt(t)),An(pt(t).index("stream"))],a=Promise.all(a).then(u(t,function(t){return{qa:Math.max(t[0],t[1]),ja:new ArrayBuffer(0),Ja:0,o:[],Ca:null,Vb:r,ib:s}})),a=a.then(t.f.bind(t,i));return a=a.then(t.g.bind(t,e,n))}function An(t){var e=new h,i=t.openCursor(null,"prev");return i.onsuccess=function(t){t.target.result?e.resolve(t.target.result.key+1):e.resolve(0)},i.onerror=function(){e.reject(i.error)},e}function _n(t,e){var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer}function Mn(t,e){var i=new h,n=dt(t)["delete"](e);n.onerror=function(){i.reject(n.error)};var r=pt(t);return r.index("stream").openKeyCursor(IDBKeyRange.only(e)).onsuccess=function(t){(t=t.target.result)&&(r["delete"](t.primaryKey),t["continue"]())},r.transaction.oncomplete=function(){i.resolve()},i}function In(t,e,i,n){ti.call(this,t),this.g=e,this.w=i,this.f=n,this.h=this.g.b||this.g.a.reduce(function(t,e){return null==e.a?NaN:t+e.a},0)||0,this.a=this.l=this.c=null,Nn(this)}function Nn(t){if(Dn(t),0!=t.length()){t.length();var e=null!=t.A().a?t.A().a:t.A().b;if(t.g.c>t.f)t.c=e;else{var i=t.f-(t.g.c+t.w.start);0>i?t.c=e:i<Math.max(t.A().b,t.A().a||0)?(t.A(),t.c=e):t.c=i}t.l=t.A().b,t.a=ei(t).b}}function Rn(t,e){if(Cn(t,e),null==t.c||null==t.l||null==t.a)return{start:0,end:0};var i=Number.POSITIVE_INFINITY;t.h&&(i=t.h);var n=e-t.f,r=t.c+n;return null!=t.g.f&&(r=r-t.a-t.g.f,0<r&&(t.a+=r)),t.a=Math.min(t.a,i),n=t.l+n,n<t.a?{start:t.a,end:t.a}:(n=0<t.length()?null!=t.A().a?Math.min(n,t.A().a):n:t.a,n=Math.max(n,t.a),n=Math.min(n,i),{start:t.a,end:n})}function Cn(t,e){if(Dn(t),null!=t.g.f)if(null==t.c)t.length();else{for(var i=t.c+(e-t.f),n=0,r=0;r<t.o.length;++r){var s=null;if(r<t.o.length-1?s=t.o[r+1].a:(s=t.o[r],s=null!=s.a?s.a+(s.a-s.b):null),!(null!=s&&s<i-t.g.f))break;++n}0<n&&t.o.splice(0,n)}}function Dn(t){if(t.h){for(var e=0,i=t.o.length-1;0<=i&&t.o[i].b>t.h;--i)++e;0<e&&t.o.splice(-e)}}function xn(t,e,i,n,r,s,a){this.g=t,this.i=e,this.f=i,this.a=n,this.c=r,this.j=s,this.b=null,this.h=a}function On(t,e,i,n,r){this.b=t,this.c=e,this.f=i,this.h=n,this.a=null,this.g=r}function Ln(){this.id=this.url=null,this.type="static",this.b=this.j=this.u=this.hb=null,this.h=5,this.f=this.c=this.g=null,this.i=1,this.a=[]}function Un(){this.g=this.f=this.c=this.u=this.a=this.start=this.id=null,this.b=[]}function Bn(){this.i=this.b=this.height=this.width=this.contentType=this.lang=this.group=this.id=null,this.c=!1,this.h=this.g=this.f=this.u=null,this.j=[],this.a=[]}function Kn(){this.value=null}function qn(){this.contentType=this.lang=this.id=null}function Fn(){this.a=this.b=this.g=this.u=this.h=this.f=this.height=this.width=this.bandwidth=this.lang=this.id=null,this.c=[]}function Vn(){this.b=this.a=this.c=this.f=null}function Hn(){this.parsedPssh=this.psshBox=null}function zn(){this.url=null}function Gn(){this.url=null}function Yn(){this.u=null,this.g=1,this.c=this.b=this.a=this.f=null}function Wn(){this.a=this.url=null}function Jn(){this.a=this.url=null}function $n(){this.u=null,this.f=1,this.b=this.g=null,this.i=1,this.h=null,this.a=[],this.c=null}function Xn(){this.a=this.b=null}function Qn(){this.a=1,this.b=this.i=null,this.j=1,this.c=this.g=this.f=this.h=null}function Zn(){this.a=[]}function tr(){this.c=this.a=this.b=null}function er(t,e){this.na=t,this.end=e}function ir(t){for(var e=[],i=0;i<t.b.length;++i){var n=t.b[i];null!=n.group&&(e[n.group]=!0)}for(i=0;i<t.b.length;++i)if(n=t.b[i],null==n.group){for(var r=1;1==e[r];)++r;e[r]=!0,n.group=r}}function nr(t,e){if(!e||0===e.length)return t;for(var i=[],n=0;n<e.length;n++){var r=e[n].url;null==t||0===t.length?i.push(new Ae(r)):(r=rr(t.slice(0,1),r),i.push(r[0]))}return i}function rr(t,e){if(!e)return t;var i=new Ae(e);return t?t.map(function(t){return t.resolve(i)}):[i]}function sr(t,e,i){var n=cr(i);return(e=or(e,i.constructor.TAG_NAME))&&n.parse(t,e),n}function ar(t,e,i){var n=null;return(e=or(e,i.TAG_NAME))&&(n=new i,n.parse(t,e)),n}function or(t,e){for(var i=null,n=0;n<t.childNodes.length;n++)if(t.childNodes[n].tagName==e){if(i)return null;i=t.childNodes[n]}return i}function hr(t,e,i){for(var n=[],r=0;r<e.childNodes.length;r++)if(e.childNodes[r].tagName==i.TAG_NAME){var s=new i;s.parse.call(s,t,e.childNodes[r]),n.push(s)}return n}function ur(t){return t=t.firstChild,t.nodeType!=Node.TEXT_NODE?null:t.nodeValue}function lr(t){return t?t.map(function(t){return t.clone()}):null}function cr(t){return t?t.clone():null}function fr(t,e,i,n){return t=i(t.getAttribute(e)),null!=t?t:void 0!==n?n:null}function pr(t){return t?(t=Date.parse(t),isNaN(t)?null:Math.floor(t/1e3)):null}function dr(e){if(!e)return null;var i=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e);if(!i)return null;e=0;var n=gr(i[1]);return n&&(e+=31536e3*n),(n=gr(i[2]))&&(e+=2592e3*n),(n=gr(i[3]))&&(e+=86400*n),(n=gr(i[4]))&&(e+=3600*n),(n=gr(i[5]))&&(e+=60*n),i=t.parseFloat(i[6]),(i=isNaN(i)?null:i)&&(e+=i),e}function yr(t){var e=/([0-9]+)-([0-9]+)/.exec(t);return e?(t=gr(e[1]),null==t?null:(e=gr(e[2]),null==e?null:new er(t,e))):null}function br(e){return e=t.parseInt(e,10),isNaN(e)?null:e}function vr(e){return e=t.parseInt(e,10),0<e?e:null}function gr(e){return e=t.parseInt(e,10),0<=e?e:null}function mr(t){return t}function wr(t,e,i,n){for(var r=e.a,s=[],a=0;a<n;++a){var o=a+i,h=(o-1)*r.b,u=h/r.a,l=(h+r.b)/r.a,o=Tr(t,e,r.j+o-1,h);if(!o)return null;s.push(new We(u,l,o))}return s}function Tr(t,e,i,n){if(!e.a)return null;var r=e.a.h;return r?(i=Er(r,e.id,i,e.bandwidth,n))?(e=He(e.u,i),new Ve(t,e,0,null)):null:e.u?new Ve(t,e.u,0,null):null}function Er(e,i,n,r,s){var a={RepresentationID:i,Number:n,Bandwidth:r,Time:s};e=e.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(e,i,n){if("$$"==e)return"$";var r=a[i];return null==r?e:("RepresentationID"==i&&n&&(n=void 0),e=r.toString(),n=t.parseInt(n,10)||1,n=Math.max(0,n-e.length),Array(n+1).join("0")+e)});try{return new Ae(e)}catch(o){if(o instanceof URIError)return null;throw o}}function kr(t,e,i){var n=0;e*=i,t=t.a,i=[];for(var r=0;r<t.length&&t[r].a;++r){var s=t[r].b,s=null!=s?s:n,a=t[r].c||0;0>a&&(a=t[r].a,a=r+1===t.length?Math.ceil((t[0].b+e-s)/a)-1:Math.ceil((t[r+1].b-s)/a)-1),0<i.length&&s!=n&&(i[i.length-1].end=s);for(var o=0;o<=a;++o)n=s+t[r].a,i.push({start:s,end:n}),s=n}return i}function Pr(t,e){this.a=new Le,this.a.f="text",this.a.a=3,this.a.c=1e3*(null!=e?e:0),this.a.g=!0,this.b=t}function Sr(t){var e=t.b;return ze(e,t.a).then(function(t){var i;i=e.b;var n=[e.h];return(i=(t=(new DOMParser).parseFromString(t,"text/xml"))?ar({hb:i,u:n},t,Ln):null)?Promise.resolve(i):(i=Error("MPD parse failure."),i.type="dash",Promise.reject(i))})}function jr(t,e,i,n,r){this.c=t,this.b=e,this.g=i,this.a=null,this.h=n,this.f=r}function Ar(t,e,i,n,r){var s,a=1,o=0;if(t.c>n)s=null;else{var h=t.i||0,u=t.f||0;s=i.a,s=s.b/s.a;var l=n-(t.c+e.start);0>l?s=null:(u=l-2*s-u,0>u&&(u=0),u=Math.ceil(u/s)*s,l-=s,0>l?s=null:(h=Math.floor(l/s)*s-h,0>h&&(h=0),h=Math.floor(h/s)*s,s={Ya:u/s+1,current:(h>=u?h:u)/s+1}))}if(s&&(a=s.Ya,o=s.current-s.Ya+1),a=wr(r,i,a,o),null==a)throw t=Error("Failed to generate SegmentReferences."),t.type="stream",t;In.call(this,a,t,e,n),this.s=i,this.v=this.b=0<this.length()?t.c+e.start+this.A().a:null,this.j=s?s.current+1:null,this.B=r}function _r(t,e){if(null!=t.b&&null!=t.v&&null!=t.j){var i=t.s.a,i=i.b/i.a,n=Math.floor((t.v+(e-t.f)-t.b)/i);if(0!=n){var r=wr(t.B,t.s,t.j,n);Array.prototype.push.apply(t.o,Xe(r,t.i)),t.b+=n*i,t.j+=n}}}function Mr(t,e,i,n,r){this.f=t,this.b=e,this.c=i,this.h=n,this.a=null,this.g=r}function Ir(t){this.a=t}function Nr(t,e,i){for(var n=R()/1e3,r=0;r<e.a.length;++r)for(var s=e.a[r],a=0;a<s.b.length;++a){var o=s.b[a];if("text"!=o.contentType)for(var h=0;h<o.a.length;++h){var u=o.a[h],l=0,l=l+(u.g?1:0),l=l+(u.b?1:0),l=l+(u.a?1:0);0==l?(o.a.splice(h,1),--h):1!=l&&(u.g?(u.b=null,u.a=null):u.b&&(u.a=null))}}for(Rr(e),r=0;r<e.a.length;++r)for(s=e.a[r],a=0;a<s.b.length;++a){for(h=o=s.b[a],u=null,l=0;l<h.a.length;++l){var c=h.a[l].f||"";u?c!=u&&(h.a.splice(l,1),--l):u=c}0==o.a.length&&(s.b.splice(a,1),--a)}for("dynamic"==e.type&&null==e.c&&(e.c=n),r=new li,"dynamic"==e.type&&(r.b=!0,r.f=e.g,r.g=new Ve(i,e.j||e.url),r.h=e.c),r.c=e.h||5,s=0;s<e.a.length&&(a=e.a[s],null!=a.start);++s)a=Cr(t,e,a,n,i),r.a.push(a);return r}function Rr(t){if(t.a.length){null==t.a[0].start&&(t.a[0].start=0);var e=function(t){return 0==t||!!t};"dynamic"==t.type&&(t.b=null),e(t.b)&&1==t.a.length&&!e(t.a[0].a)&&(t.a[0].a=t.b);for(var i=0,n=!0,r=0;r<t.a.length;++r){var s=t.a[r-1],a=t.a[r],o=t.a[r+1]||{start:t.b};!e(a.start)&&s&&e(s.start)&&e(s.a)&&(a.start=s.start+s.a),!e(a.a)&&e(o.start)&&(a.a=o.start-a.start),null!=a.start&&null!=a.a?i+=a.a:n=!1}e(t.b)||(r=t.a[t.a.length-1],n?t.b=i:e(r.start)&&e(r.a)?t.b=r.start+r.a:"dynamic"!=t.type&&(t.b=i))}}function Cr(t,e,i,n,r){var s=new ui;s.id=i.id,s.start=i.start,s.b=i.a;var a=new _;i.b.forEach(function(t){a.push(t.contentType||"",t)});for(var o=N(a),h=0;h<o.length;++h){var u=new _;a.get(o[h]).forEach(function(t){u.push(t.group,t)});for(var l=N(u),c=0;c<l.length;++c){var f=new _;u.get(l[c]).forEach(function(t){f.push(t.lang,t)});for(var p=N(f),d=0;d<p.length;++d){var y=f.get(p[d]),y=Dr(t,e,i,y,n,r);s.a.push(y)}}}return s}function Dr(t,e,i,n,r,s){C(n.every(function(t){return t.group==n[0].group&&(t.lang||"")==(n[0].lang||"")&&(t.contentType||"")==(n[0].contentType||"")}));var a=new oi,o=n.filter(function(t){return null!=t.id});o.length==n.length&&(a.id=o.map(function(t){return t.id}).sort().reduce(function(t,e){return t+","+e})),a.lang=n[0].lang||"",a.contentType=n[0].contentType||"",a.b=n.some(function(t){return t.c});for(var o={},h=0;h<n.length;++h)for(var u=n[h],l=0;l<u.a.length;++l){var c=u.a[l],f=Lr(t,c),p=a.a.slice(0);Or(f,p),0==p.length&&0<a.a.length||!(c=Br(e,i,c,r,s))||(a.m.push(c),a.a=p,o[c.C]=u)}if(a.a.some(function(t){return""==t.a}))return a.m.forEach(function(t){t.N=!0}),a;for(t=xr(n),h=0;h<a.m.length;++h)c=a.m[h],u=o[c.C],u==t&&(c.N=!0);return a}function xr(t){for(var e=null,i=null,n=0;n<t.length;++n)for(var r=t[n],s=0;s<r.a.length;++s){var a=r.a[s],a=(a.width||1)*(a.height||1)*(a.bandwidth||1);(null==e||a<e)&&(e=a,i=r)}return i}function Or(t,e){if(0==e.length)Array.prototype.push.apply(e,t);else for(var i=0;i<e.length;++i){for(var n=!1,r=0;r<t.length;++r){var s=e[i],a=t[r];if(s.a==a.a&&s.h==a.h&&s.i==a.i&&s.g==a.g&&s.v==a.v&&s.f==a.f&&s.j==a.j&&E(s.c,a.c)){n=!0,L(e[i],t[r].b);break}}n||(e.splice(i,1),--i)}}function Lr(t,e){var i=[];if(0==e.c.length)i.push(new D);else if(t.a)for(var n=0;n<e.c.length;++n)i.push.apply(i,Ur(t,e.c[n]));return i}function Ur(t,e){var i=[];if(2!=t.a.length)return[];var n=t.a(e.c||"",e.f);if(!(n&&n instanceof Array))return[];for(var r=0;r<n.length;++r){var s=x(n[r]);0==s.b.length&&e.a&&e.a.psshBox&&L(s,[{initData:e.a.psshBox,initDataType:"cenc"}]),i.push(s)}return i}function Br(t,e,i,n,r){if(!i.u||0===i.u.length)return null;var s=null,a=1,o=0;if(i.g)s=i.f.split("/")[1],"mp4"!=s&&"webm"!=s?s=null:(a=i.g,("webm"!=s||a.c)&&(a.a||a.b&&a.b.a)?(o=a.b,o||(o=new Wn,o.url=i.u,o.a=a.a?a.a.clone():null),o=qr(o,r),a=a.c?qr(a.c,r):null,t=new xn(t,e,s,o,a,n,r),e=new Ye(a),n=new si,n.I=t,n.H=e,s=n):s=null),a=i.g.g,o=i.g.f;else if(i.b)s=i.b,!s.b&&!s.c&&1<s.a.length?s=null:s.b||e.a||s.c||1!=s.a.length?s.c&&0===s.c.a.length?s=null:(s=s.h?qr(s.h,r):null,t=new jr(t,e,i,n,r),e=new Ye(s),n=new si,n.I=t,n.H=e,s=n):s=null,a=i.b.f,o=i.b.g;else if(i.a){t:if(s=i.a,a=0+(s.f?1:0),a+=s.c?1:0,a+=s.b?1:0,0==a?a=!1:(1!=a&&(s.f?(s.c=null,s.b=null):s.c&&(s.b=null)),a=!0),a){if(a=null,s.g&&(a=(s=i.a.g)?Kr(i,s,Jn):null,!a)){s=null;break t}s=a?qr(a,r):null,a=i.a,a.f?(a=i.f.split("/")[1],"mp4"!=a&&"webm"!=a?t=null:("webm"!=a||s)&&Tr(r,i,1,0)&&(o=(o=i.a.f)?Kr(i,o,Wn):null)?(o=qr(o,r),t=new xn(t,e,a,o,s,n,r)):t=null):t=a.h?a.c?new On(t,e,i,n,r):a.b?"dynamic"!=t.type&&null==e.a?null:new Mr(t,e,i,n,r):null:null,t?(e=new Ye(s),n=new si,n.I=t,n.H=e,s=n):s=null}else s=null;a=i.a.a,o=i.a.i}else"text"==i.f.split("/")[0]&&(s=new si,s.I=new ni(new Ve(r,i.u)));if(!s)return null;for(s.id=i.id,o&&(s.c=-1*o/a),s.bandwidth=i.bandwidth,s.width=i.width,s.height=i.height,s.a=i.f||"",s.b=i.h||"",t=0;t<i.c.length;++t)e=i.c[t],e.b&&s.f.push(e.b);return s}function Kr(t,e,i){return(e=Er(e,t.id,null,t.bandwidth,null))?(i=new i,i.url=He(t.u,e),i):null}function qr(t,e){var i=t.url,n=0,r=null;return t.a&&(n=t.a.na,r=t.a.end),new Ve(e,i,n,r)}function Fr(t,e,i){e||(e=new Y),i||(i=new Zi),nn.call(this,null,e,i),this.R=t,this.M=[],this.timeoutMs=3e4,this.l={},this.j=this.ga=null}function Vr(t,e,i,n){var r=new kn(t.Z,t);return null!=t.l.segmentRequestTimeout&&(r.b=Number(t.l.segmentRequestTimeout)),lt(r).then(u(t,function(){return Pn(r,e,this.M,n,i)})).then(function(t){return ct(r),Promise.resolve(t)})["catch"](function(t){return ct(r),Promise.reject(t)})}function Hr(t){var e=new kn(null,null);return lt(e).then(u(t,function(){return Sn(e,this.R)})).then(function(){return ct(e),Promise.resolve()})["catch"](function(t){return ct(e),Promise.reject(t)})}function zr(e){var i=document.createElement("video");i.src=t.URL.createObjectURL(e.g);var n=new Ai(null,i,e);return null!=e.l.licenseRequestTimeout&&(n.w=Number(e.l.licenseRequestTimeout)),e.X().then(function(){return n.initialize()}).then(u(e,function(){return _i(n,this.timeoutMs)})).then(function(){return Mi(n)}).then(u(e,function(){return n.destroy(),this.destroy(),Promise.resolve()}))["catch"](u(e,function(t){return n.destroy(),this.destroy(),Promise.reject(t)}))}function Gr(t,e,i,n){i||(i=new Y),n||(n=new Zi),nn.call(this,null,i,n),this.za=t,this.l=null,this.M=e,this.R=[],this.ga=[],this.ta=[],this.j=null}var Yr,Wr=this;e("shaka.player.TextTrack.compare",function(t,e){return t.lang<e.lang?-1:t.lang>e.lang?1:0}),r.prototype.clone=function(){var t=new r;return t.maxHeight=this.maxHeight,t.minHeight=this.minHeight,t.maxWidth=this.maxWidth,t.maxBandwidth=this.maxBandwidth,t.minBandwidth=this.minBandwidth,t},e("shaka.player.VideoTrack.compare",a),e("shaka.player.AudioTrack.compare",function(t,e){return t.lang<e.lang?-1:t.lang>e.lang?1:t.bandwidth<e.bandwidth?-1:t.bandwidth>e.bandwidth?1:0}),h.prototype.destroy=function(){this["catch"](function(){});var t=Error("Destroyed!");t.type="destroy",this.reject(t)};var Jr={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};e("shaka.util.Uint8ArrayUtils.toString",g),e("shaka.util.Uint8ArrayUtils.fromString",m),e("shaka.util.Uint8ArrayUtils.toBase64",function(e,i){var n=void 0==i||i,r=t.btoa(g(e)).replace(/\+/g,"-").replace(/\//g,"_");
return n?r:r.replace(/=*$/,"")}),e("shaka.util.Uint8ArrayUtils.fromBase64",w),e("shaka.util.Uint8ArrayUtils.fromHex",function(e){for(var i=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)i[n/2]=t.parseInt(e.substr(n,2),16);return i}),e("shaka.util.Uint8ArrayUtils.toHex",T);var $r;_.prototype.push=function(t,e){this.a.hasOwnProperty(t)?this.a[t].push(e):this.a[t]=[e]},_.prototype.set=function(t,e){this.a[t]=e},_.prototype.get=function(t){return(t=this.a[t])?t.slice():null};var Xr=0;B.prototype.sample=function(t,e){var i=Math.pow(this.c,t);this.b=e*(1-i)+i*this.b,this.a+=t};var Qr=1,Zr=2,ts={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};e("shaka.util.FakeEventTarget",z),z.prototype.addEventListener=function(t,e,i){i||this.ya.push(t,e)},z.prototype.removeEventListener=function(t,e,i){i||I(this.ya,t,e)},z.prototype.dispatchEvent=function(t){if(t.hasOwnProperty("srcElement")||(delete t.srcElement,Object.defineProperty(t,"srcElement",{get:function(){return null}})),t.hasOwnProperty("target"))t.target=this;else{delete t.target;var e=this;Object.defineProperty(t,"target",{get:function(){return e},set:function(t){e=t}})}if(t.hasOwnProperty("currentTarget"))t.currentTarget=null;else{delete t.currentTarget;var i=null;Object.defineProperty(t,"currentTarget",{get:function(){return i},set:function(t){i=t}})}return G(this,t)},i(Y,z),e("shaka.util.EWMABandwidthEstimator",Y),Y.prototype.sample=function(t,e){if(!(65536>e)){t=Math.max(t,50);var i=8e3*e/t,n=t/1e3;this.a.sample(n,i),this.c.sample(n,i),this.dispatchEvent(q({type:"bandwidth"})),this.b=Date.now()}},Y.prototype.getBandwidth=function(){return.5>this.a.a?5e5:Math.min(K(this.a),K(this.c))},Y.prototype.getDataAge=function(){return(Date.now()-this.b)/1e3},Y.prototype.supportsCaching=function(){return!1};var es=0,is=1;et.prototype.start=function(){if(this.f)throw Error("Task already started!");this.f=!0,this.b.unshift(function(){}),nt(this,void 0)},et.prototype.end=function(){this.b.splice(1)},st.prototype.destroy=function(){ot(this),this.a=null},st.prototype.sa=function(t,e){for(var i=this.a.get(e)||[],n=0;n<i.length;++n){var r=i[n];r.target==t&&(r.sa(),I(this.a,e,r))}},ht.prototype.sa=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)},i(ut,z),i(gt,ut);var ns=1/60;kt.prototype.destroy=function(){_t(this)["catch"](function(){}),this.f&&this.f.destroy(),this.a=this.f=null,this.g&&(ct(this.g),this.g=null),this.b=null,this.j.destroy(),this.i=this.c=this.j=null},kt.prototype.h=function(){this.f&&"open"==this.i.readyState&&this.c.abort()},kt.prototype.B=function(){this.f&&(this.f.resolve(),this.f=null)},Rt("error"),Rt("warn"),Rt("info"),Rt("log"),Rt("debug"),e("shaka.player.TextStyle",Ct),Ct.prototype.a=function(){var e=t.localStorage.getItem("ShakaPlayerTextStyle");if(e){var i;try{i=JSON.parse(e)}catch(n){return}if(i&&"object"==typeof i){var r,e=i;for(r in e)r in this&&(this[r]=e[r])}}},Ct.prototype.load=Ct.prototype.a,Ct.prototype.b=function(){t.localStorage.setItem("ShakaPlayerTextStyle",JSON.stringify(this))},Ct.prototype.store=Ct.prototype.b;var rs=[255,255,255],ss=[0,0,0];Ct.StandardColors={WHITE:rs,BLACK:ss,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var as=1;Ct.StandardOpacities={OPAQUE:as,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var os=[];Ct.EdgeStyles={NONE:os,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};var hs=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now,us={},ls=0;e("shaka.polyfill.Promise.install",qt),Kt.prototype.then=function(t,e){var i=new Kt;switch(this.ba){case 1:Gt(this,i,t);break;case 2:Gt(this,i,e);break;case ls:this.c.push({Ia:i,Ba:t}),this.b.push({Ia:i,Ba:e})}return i},Kt.prototype.then=Kt.prototype.then,Kt.prototype["catch"]=function(t){return this.then(void 0,t)},Kt.prototype["catch"]=Kt.prototype["catch"],Kt.prototype.W=function(t){if(this.ba==ls){for(this.wa=t,this.ba=1,t=0;t<this.c.length;++t)Gt(this,this.c[t].Ia,this.c[t].Ba);this.c=[],this.b=[]}},Kt.prototype.a=function(t){if(this.ba==ls){for(this.wa=t,this.ba=2,t=0;t<this.b.length;++t)Gt(this,this.b[t].Ia,this.b[t].Ba);this.c=[],this.b=[]}};var cs=null,fs=[];Xt.prototype.createMediaKeys=function(){var t=new Zt(this.keySystem);return Promise.resolve(t)},Xt.prototype.getConfiguration=function(){return this.a},Zt.prototype.createSession=function(t){if("temporary"!=(t||"temporary"))throw new TypeError("Session type "+t+" is unsupported on this platform.");return new ee(this.a)},Zt.prototype.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))},i(ee,z),Yr=ee.prototype,Yr.generateRequest=function(t,e){this.a=new h;try{this.c=this.g.createSession("video/mp4",new Uint8Array(e),null),at(this.f,this.c,"mskeymessage",this.Bb.bind(this)),at(this.f,this.c,"mskeyadded",this.zb.bind(this)),at(this.f,this.c,"mskeyerror",this.Ab.bind(this)),re(this,"status-pending")}catch(i){this.a.reject(i)}return this.a},Yr.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},Yr.update=function(t){this.b=new h;try{this.c.update(new Uint8Array(t))}catch(e){this.b.reject(e)}return this.b},Yr.close=function(){try{this.c.close(),this.closed.resolve(),ot(this.f)}catch(t){this.closed.reject(t)}return this.closed},Yr.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},Yr.Bb=function(t){this.a&&(this.a.resolve(),this.a=null),t=q({type:"message",messageType:void 0==this.keyStatuses.Fa()?"licenserequest":"licenserenewal",message:t.message.buffer}),this.dispatchEvent(t)},Yr.zb=function(){this.a?(this.a.resolve(),this.a=null):this.b&&(re(this,"usable"),this.b.resolve(),this.b=null)},Yr.Ab=function(){var t=Error("EME v20140218 key error");if(t.errorCode=this.c.error,null!=this.a)this.a.reject(t),this.a=null;else if(null!=this.b)this.b.reject(t),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:re(this,"output-not-allowed");default:re(this,"internal-error")}};var ps;Yr=se.prototype,Yr.Ma=function(t){this.size=void 0==t?0:1,this.a=t},Yr.Fa=function(){return this.a},Yr.forEach=function(t){this.a&&t(ps,this.a)},Yr.get=function(t){if(this.has(t))return this.a},Yr.has=function(t){var e=ps;return!(!this.a||!E(new Uint8Array(t),new Uint8Array(e)))},e("shaka.polyfill.CustomEvent.install",ae),e("shaka.polyfill.VideoPlaybackQuality.install",he),e("shaka.polyfill.Fullscreen.install",le),de.prototype.createSession=function(){},de.prototype.setServerCertificate=function(){},ye.prototype.getConfiguration=function(){},ye.prototype.createMediaKeys=function(){},ge.prototype.createMediaKeys=function(){var t=new me(this.a);return Promise.resolve(t)},ge.prototype.getConfiguration=function(){return this.b},Yr=me.prototype,Yr.createSession=function(t){var e=t||"temporary";if("temporary"!=e&&"persistent-license"!=e)throw new TypeError("Session type "+t+" is unsupported on this platform.");return t=this.b||document.createElement("video"),t.src||(t.src="about:blank"),e=new Ee(t,this.g,e),this.c.push(e),e},Yr.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))},Yr.Ob=function(t){t=q({type:"encrypted",initDataType:"webm",initData:t.initData}),this.b.dispatchEvent(t)},Yr.Nb=function(t){var e=Te(this,t.sessionId);e&&(t=q({type:"message",messageType:void 0==e.keyStatuses.Fa()?"licenserequest":"licenserenewal",message:t.message}),e.b&&(e.b.resolve(),e.b=null),e.dispatchEvent(t))},Yr.Lb=function(t){(t=Te(this,t.sessionId))&&(Pe(t,"usable"),t.a&&t.a.resolve(),t.a=null)},Yr.Mb=function(t){var e=Te(this,t.sessionId);if(e){var i=Error("EME v0.1b key error");i.errorCode=t.errorCode,i.errorCode.systemCode=t.systemCode,!t.sessionId&&e.b?(i.method="generateRequest",45==t.systemCode&&(i.message="Unsupported session type."),e.b.reject(i),e.b=null):t.sessionId&&e.a?(i.method="update",e.a.reject(i),e.a=null):(i=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Pe(e,"output-restricted"):1==i?Pe(e,"expired"):Pe(e,"internal-error"))}},i(Ee,z),Yr=Ee.prototype,Yr.Qa=function(t,e){if(this.a)this.a.then(this.Qa.bind(this,t,e))["catch"](this.Qa.bind(this,t,e));else{this.a=t;var i,n;"webkit-org.w3.clearkey"==this.c?(i=g(new Uint8Array(e)),n=JSON.parse(i),"oct"!=n.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),i=w(n.keys[0].k),n=w(n.keys[0].kid)):(i=new Uint8Array(e),n=null);try{this.f.webkitAddKey(this.c,i,n,this.sessionId)}catch(r){this.a.reject(r),this.a=null}}},Yr.generateRequest=function(t,e){return ke(this,e,null)},Yr.load=function(t){return"persistent-license"==this.g?ke(this,null,t):Promise.reject(Error("Not a persistent session."))},Yr.update=function(t){var e=new h;return this.Qa(e,t),e},Yr.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.f.webkitCancelKeyRequest(this.c,this.sessionId)}return this.closed.resolve(),this.closed},Yr.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};var ds;Yr=Se.prototype,Yr.Ma=function(t){this.size=void 0==t?0:1,this.a=t},Yr.Fa=function(){return this.a},Yr.forEach=function(t){this.a&&t(ds,this.a)},Yr.get=function(t){if(this.has(t))return this.a},Yr.has=function(t){var e=ds;return!(!this.a||!E(new Uint8Array(t),new Uint8Array(e)))},e("shaka.polyfill.MediaKeys.install",je),e("shaka.polyfill.installAll",function(){ae(),le(),he(),qt(),je()});var ys=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;Yr=Ae.prototype,Yr.P="",Yr.ca="",Yr.S="",Yr.ia=null,Yr.O="",Yr.aa="",Yr.toString=function(){var t=[],e=this.P;if(e&&t.push(Re(e,bs,!0),":"),e=this.S){t.push("//");var i=this.ca;i&&t.push(Re(i,bs,!0),"@"),t.push(encodeURIComponent(e).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.ia,null!=e&&t.push(":",String(e))}return(e=this.O)&&(this.S&&"/"!=e.charAt(0)&&t.push("/"),t.push(Re(e,"/"==e.charAt(0)?gs:vs,!0))),(e=this.a.toString())&&t.push("?",e),(e=this.aa)&&t.push("#",Re(e,ws)),t.join("")},Yr.resolve=function(t){var e=this.clone();"data"===e.P&&(e=new Ae);var i=!!t.P;i?_e(e,t.P):i=!!t.ca,i?e.ca=t.ca:i=!!t.S,i?e.S=t.S:i=null!=t.ia;var n=t.O;if(i)Me(e,t.ia);else if(i=!!t.O){if("/"!=n.charAt(0))if(this.S&&!this.O)n="/"+n;else{var r=e.O.lastIndexOf("/");-1!=r&&(n=e.O.substr(0,r+1)+n)}if(".."==n||"."==n)n="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){for(var r=0==n.lastIndexOf("/",0),n=n.split("/"),s=[],a=0;a<n.length;){var o=n[a++];"."==o?r&&a==n.length&&s.push(""):".."==o?((1<s.length||1==s.length&&""!=s[0])&&s.pop(),r&&a==n.length&&s.push("")):(s.push(o),r=!0)}n=s.join("/")}}return i?e.O=n:i=""!==t.a.toString(),i?Ie(e,t.a.clone()):i=!!t.aa,i&&(e.aa=t.aa),e},Yr.clone=function(){return new Ae(this)};var bs=/[#\/\?@]/g,vs=/[\#\?:]/g,gs=/[\#\?]/g,ms=/[\#\?@]/g,ws=/#/g;De.prototype.a=null,De.prototype.c=null,De.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var t,e=[];for(t in this.a)for(var i=encodeURIComponent(t),n=this.a[t],r=0;r<n.length;r++){var s=i;""!==n[r]&&(s+="="+encodeURIComponent(n[r])),e.push(s)}return this.b=e.join("&")},De.prototype.clone=function(){var t=new De;if(t.b=this.b,this.a){var e,i={};for(e in this.a)i[e]=this.a[e].concat();t.a=i,t.c=this.c}return t};var Ts=!0;Yr=Oe.prototype,Yr.rb=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var e=this.url.split(":")[1].split(";").pop().split(","),i=e.pop(),i="base64"==e.pop()?t.atob(i.replace(/-/g,"+").replace(/_/g,"/")):t.decodeURIComponent(i);return"arraybuffer"==this.b.f&&(i=m(i).buffer),e=JSON.parse(JSON.stringify(new XMLHttpRequest)),e.response=i,e.responseText=i.toString(),i=this.c,i.resolve(e),Ue(this),i}if(0==this.url.lastIndexOf("idb:",0))return Ke(this);this.h++,this.i=Date.now(),this.g||(this.g=this.b.h),this.a=new XMLHttpRequest,e=this.url,Ts&&(this.f&&!this.f.supportsCaching()||this.b.g)&&(e=new Ae(e),xe(e.a,"_",Date.now()),e=e.toString()),this.a.open(this.b.method,e,!0),this.a.responseType=this.b.f,this.a.timeout=this.b.c,this.a.withCredentials=this.b.j,this.a.onload=this.xb.bind(this),this.b.g&&(this.a.onreadystatechange=this.Eb.bind(this)),this.a.onerror=this.Tb.bind(this),this.a.ontimeout=this.Ib.bind(this);for(i in this.b.b)this.a.setRequestHeader(i,this.b.b[i]);return this.a.send(this.b.body),this.c},Yr.xb=function(t){this.f&&this.f.sample(Date.now()-this.i,t.loaded),200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),Ue(this)):this.h<this.b.a?Fe(this):(t=qe(this,"HTTP error.","net"),this.c.reject(t),Ue(this))},Yr.Eb=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED){var t=Date.parse(this.a.getResponseHeader("Date"));t&&(Xr=t-Date.now())}},Yr.Tb=function(){var t=qe(this,"Network failure.","net");this.c.reject(t),Ue(this)},Yr.Ib=function(){if(this.h<this.b.a)Fe(this);else{var t=qe(this,"Request timed out.","net");this.c.reject(t),Ue(this)}},Ve.prototype.g=function(){if(this.c){this.a=null;var t=this.c;if(t.a&&t.a.readyState!=XMLHttpRequest.DONE){t.a.abort();var e=qe(t,"Request aborted.","aborted");t.c.reject(e),Ue(t)}this.h=this.c=null}},Ve.prototype.clone=function(){return new Ve(this.j,this.b.map(function(t){return t.clone()}),this.f,this.i)},Ve.prototype.toString=function(){return this.b[0].toString()},Ye.prototype.destroy=function(){this.a&&(this.a.g(),this.a=null),this.b=null},Ye.prototype.create=function(){return this.a?ze(this.a):Promise.resolve(this.b)},Qe.prototype.parse=function(t,e,i,n){var r=null;try{t:{var s=[],a=new W(t),o=X(a);if(1936286840!=X(a))r=null;else{1==o&&(o=Q(a));var h=$(a);tt(a,3),tt(a,4);var u=X(a);if(0==u)r=null;else{var l,c;0==h?(l=X(a),c=X(a)):(l=Q(a),c=Q(a)),tt(a,2);var f=a.b.getUint16(a.a,a.c);for(a.a+=2,t=l,e=e+o+c,o=0;o<f;o++){var p=X(a);c=(2147483648&p)>>>31;var h=2147483647&p,d=X(a);if(X(a),1==c){r=null;break t}var y=new Ve(n,i,e,e+h-1);s.push(new We(t/u,(t+d)/u,y)),t+=d,e+=h}r=s}}}}catch(b){if(!(b instanceof RangeError))throw b}return r},Ze.prototype.parse=function(t,e,i,n){var r=null;try{var s,a=new k(e);if(440786851!=P(a).id)s=null;else{var o=P(a);if(408125543!=o.id)s=null;else{var h,u=o.a.byteOffset,l=new k(o.a);for(e=null;J(l.a);){var c=P(l);if(357149030==c.id){e=c;break}}if(e){for(var f=new k(e.a),l=1e6;J(f.a);){var p=P(f);if(2807729==p.id){l=A(p);break}}h=l/1e9}else h=null;s=h?{Qb:u,Ub:h}:null}}if(s){var d=P(new k(t));if(475249515!=d.id)r=null;else{var y=s.Qb,b=s.Ub;t=[];var v=new k(d.a);for(s=d=-1;J(v.a);){var g=P(v);if(187==g.id){var m,w=new k(g.a),T=P(w);if(179!=T.id)m=null;else{var E=A(T),S=P(w);if(183!=S.id)m=null;else{for(var j=new k(S.a),u=0;J(j.a);){var _=P(j);if(241==_.id){u=A(_);break}}m={Wb:E,Pb:u}}}if(m){var M=b*m.Wb,I=y+m.Pb;if(0<=d){var N=new Ve(n,i,s,I-1);t.push(new We(d,M,N))}d=M,s=I}}}0<=d&&(N=new Ve(n,i,s,null),t.push(new We(d,null,N))),r=t}}else r=null}catch(R){if(!(R instanceof RangeError))throw R}return r},ti.prototype.destroy=function(){this.o=null},Yr=ti.prototype,Yr.length=function(){return this.o.length},Yr.A=function(){if(0==this.o.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.o[this.o.length-1]},Yr.get=function(t){if(0>t||t>=this.o.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.o[t]},Yr.la=function(t){return t=$e(this.o,t),0<=t?this.o[t]:null},Yr.Ha=function(t){return ii(this,t),!0},Yr.ka=function(t){var e=t-this.i;return 0==e?0:(this.o=Xe(this.o,e),this.i=t,e)},Yr.Ea=function(){return 0<this.length()?{start:ei(this).b,end:this.A().a}:{start:0,end:0}},ni.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)},ni.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var t=new We(0,null,this.b);return this.a=new ti([t]),Promise.resolve(this.a)},ri.prototype.destroy=function(){this.b=null,this.a&&(this.a.destroy(),this.a=null)},ri.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var t=[],e=0;e<this.b.length;++e){var i=this.b[e];t.push(new We(i.start_time,i.end_time,new Ve(null,[new Ae(i.url)],i.start_byte,null)))}return this.b=null,this.a=new ti(t),Promise.resolve(this.a)};var Es=0;si.prototype.destroy=function(){this.I&&(this.I.destroy(),this.I=null),this.H&&(this.H.destroy(),this.H=null)};var ks=0;oi.prototype.destroy=function(){for(var t=0;t<this.m.length;++t)this.m[t].destroy();this.a=this.m=null},ui.prototype.destroy=function(){for(var t=0;t<this.a.length;++t)this.a[t].destroy();this.a=null},li.prototype.destroy=function(){for(var t=0;t<this.a.length;++t)this.a[t].destroy();this.a=null},i(fi,z),fi.prototype.F=function(){},fi.prototype.destroy=function(){this.a&&this.b.removeChild(this.a),this.c.destroy(),this.v=this.b=this.f=this.h=this.a=this.c=null},Yr=fi.prototype,Yr.oa=function(){return this.f},Yr.bb=function(){return this.h},Yr.sb=function(){return this.c},Yr.Ga=function(){return!0},Yr.ra=function(t){t.I.create().then(u(this,function(e){if(this.b){if(0==e.length())return Promise.reject(Error("No subtitles URL available."));var i=this.f;this.f=t,this.h=e,e=ei(e).url.b[0].toString();var n=this.Da();this.a&&(this.va(!1),this.b.removeChild(this.a)),this.a=document.createElement("track"),this.b.appendChild(this.a),this.a.src=e,this.va(n),e=q({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:t.bandwidth}),this.dispatchEvent(e),i||this.c.resolve(0)}}))},Yr.jb=function(){},Yr.kb=function(){return!0},Yr.va=function(t){this.g=t,this.a&&(this.a.track.mode=t?"showing":"disabled")},Yr.Da=function(){return this.a&&(this.g="showing"==this.a.track.mode),this.g},i(pi,z),pi.prototype.F=function(t){null!=t.initialStreamBufferSize&&(this.B=Number(t.initialStreamBufferSize)),null!=t.streamBufferSize&&(this.L=Number(t.streamBufferSize)),null!=t.segmentRequestTimeout&&(this.a.s=Number(t.segmentRequestTimeout))},pi.prototype.destroy=function(){wi(this),this.h.destroy(),this.b=this.h=null,this.a.destroy(),this.v=this.c=this.a=null},Yr=pi.prototype,Yr.oa=function(){return this.b},Yr.bb=function(){return this.G},Yr.sb=function(t){return this.f||t.then(function(){this.f=!0,this.g||mi(this,0)}.bind(this))["catch"](function(){}),this.h},Yr.Ga=function(){return this.j},Yr.ra=function(t,e,i){if(t!=this.b){var n=[t.I.create(),t.H.create()];Promise.all(n).then(u(this,function(n){if(this.c){var r=this.b;this.b=t,this.G=n[0],this.w=n[1],this.K=!0,this.l||(r?e&&di(this,!0,i):mi(this,0))}}))["catch"](u(this,function(t){"aborted"!=t.type&&(this.f?(t=F(t),this.dispatchEvent(t)):this.h.reject(t))}))}},Yr.jb=function(){return di(this,!1)},Yr.kb=function(t){return 0<Pt(this.a,t)&&0<=$e(this.a.b,t)},Yr.va=function(){},Yr.Da=function(){return!0},Yr.Kb=function(){if(this.s&&!this.f)this.g=null;else{var t;if((t=this.f&&!this.j)&&(t=1<this.a.c.buffered.length),t)di(this,!0);else{this.g=null,t=this.b;var e=this.G,i=this.c.currentTime;Pt(this.a,this.s?i:i+(this.i||0))>=(this.s?Math.max(this.B,this.L):this.B)?(bi(this),mi(this,1e3/(Math.abs(this.c.playbackRate)||1))):(e=yi(this,i,e))?(e=St(this.a,e,t.c,this.w),this.w=null,this.K&&(this.K=!1,vi(this,t)),this.j=!1,e.then(u(this,function(t){null==this.i&&(this.i=t),this.D&&0<Pt(this.a,i)&&(this.D=!1,this.c.currentTime+=.001),mi(this,0)}))["catch"](u(this,function(t){if("aborted"!=t.type){var e=[0,404,410];"net"==t.type&&-1!=e.indexOf(t.Xb.status)&&this.b&&mi(this,5e3),t=F(t),this.dispatchEvent(t)}}))):(bi(this),this.f&&!this.j&&(this.j=!0,gi(this)),mi(this,1e3))}}},i(Ai,z),Ai.prototype.destroy=function(){this.v=null;for(var e=0;e<this.f.length;++e)this.f[e].close()["catch"](function(){});this.f=[],this.c=this.a=this.i=null,this.g.destroy(),this.g=null,this.l.destroy(),this.l=null,this.j&&(t.clearTimeout(this.j),this.j=null),this.h=this.b=null},Ai.prototype.initialize=function(){for(var t=new _,e=this.b.ab(),i=0;i<e.length;++i){var n=e[i];n.a.a||n.b&&!Ui(n.b)||t.push(n.contentType,n)}for(var i={},n=!1,r=0;r<e.length;++r){var s=e[r];if(s.a.a&&!t.a.hasOwnProperty(s.contentType)){var a=s.a.a,o=i[a];if(o||(o=s.a,o={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:o.g?"required":"optional",persistentState:o.v||this.b.ha()?"required":"optional",sessionTypes:[this.b.ha()?"persistent-license":"temporary"]},i[a]=o),s.b&&(a=s.contentType+"Capabilities",a in o)){n=!0,o[a]||(o[a]=[]);var u;"audio"==s.contentType?u=s.a.f:"video"==s.contentType&&(u=s.a.j),o[a].push({contentType:s.b,robustness:u})}}}if(!n){if(!e.length)throw t=Error("No DrmInfo exists!"),t.type="drm",t;this.a=e[0].a}return 0==Object.keys(i).length?(this.b.Ka(t),this.g.resolve(),Promise.resolve()):(u=new h,i=Ii(this,i,u),i=i.then(this.D.bind(this,e,t)),u.reject(null),i)},Ai.prototype.D=function(t,e,i){if(!this.h)return Ri();for(var n=i.keySystem,r=i.getConfiguration(),s=["audio","video"],a=0;a<s.length;++a){var o=s[a];if(!e.a.hasOwnProperty(o)){var h=r[o+"Capabilities"];if(h){for(var h=h[0],u=[],l={},c=0;c<t.length;++c){var f=t[c],p=h?f.b==h.contentType:f.contentType==o;f.a.a!=n||!p||f.id in l||(u.push(f),l[f.id]=!0,this.a=this.a?O(this.a,f.a):f.a)}e.set(o,u)}}}return this.b.Ka(e),i.createMediaKeys().then(function(t){this.i=t}.bind(this))},Ai.prototype.B=function(t){for(var e=new Uint8Array(t.initData),i=0;i<this.c.length;++i)if(E(e,this.c[i].data))return;try{var n=Di(this)}catch(r){return e=F(r),this.dispatchEvent(e),void this.g.reject(r)}t=n.generateRequest(t.initDataType,t.initData),this.c.push({data:e,La:n}),t["catch"](u(this,function(t){if(this.h){for(var e=0;e<this.c.length;++e)if(this.c[e].La==n){this.c.splice(e,1);break}e=F(t),this.dispatchEvent(e),this.g.reject(t)}})),this.f.push(n)},Ai.prototype.G=function(t){xi(this,t.target,this.a,t.message)},Ai.prototype.F=function(t){t=t.target;var e={};if(t.keyStatuses.forEach(function(t,i){if("string"==typeof t){var n=t;t=i,i=n}if("com.microsoft.playready"==this.a.a&&16==t.byteLength){var n=new DataView(t),r=n.getUint32(0,!0),s=n.getUint16(4,!0),a=n.getUint16(6,!0);n.setUint32(0,r,!1),n.setUint16(4,s,!1),n.setUint16(6,a,!1)}n=T(new Uint8Array(t)),e[n]=i}.bind(this)),t.expiration<Date.now()){for(var i=0;i<this.c.length;++i)if(this.c[i].La==t){this.c.splice(i,1);break}t.close(),this.f.splice(this.f.indexOf(t),1)}this.b.cb(e)},i(Li,z),e("shaka.player.Player",Li),Li.version="v1.6.4",Li.isBrowserSupported=function(){return!!(t.MediaSource&&t.MediaKeys&&t.navigator&&t.navigator.requestMediaKeySystemAccess&&t.MediaKeySystemAccess&&t.MediaKeySystemAccess.prototype.getConfiguration&&t.Promise&&Element.prototype.requestFullscreen&&document.exitFullscreen&&"fullscreenElement"in document&&t.Uint8Array)},Li.isTypeSupported=Ui,Li.setTextStyle=function(t){var e=document.getElementById("ShakaPlayerTextStyle");for(e||(e=document.createElement("style"),e.id="ShakaPlayerTextStyle",document.head.appendChild(e)),e=e.sheet;e.cssRules.length;)e.deleteRule(0);e.insertRule("::cue { "+Dt(t)+" }",0)},Li.prototype.destroy=function(){return this.s().then(u(this,function(){this.f.destroy(),this.a=this.f=null}))["catch"](function(){})},Li.prototype.destroy=Li.prototype.destroy,Li.prototype.s=function(){if(!this.b)return Promise.resolve();this.h&&Vi(this),this.a.pause(),ot(this.f),Fi(this),Ki(this),this.i&&(this.i.destroy(),this.i=null),this.a.src="";var t=this.a.setMediaKeys(null);return this.b&&(this.b.destroy(),this.b=null),this.h=!1,this.g=new Ti,t},Li.prototype.unload=Li.prototype.s,Li.prototype.ea=function(t){var e=this.s();return this.a.autoplay&&(Lt("load"),at(this.f,this.a,"timeupdate",this.wb.bind(this))),t.T(this.c),t.pb(this.F),this.F=null,e=e.then(u(this,function(){return t.X()})),e["catch"](u(this,function(e){return t.destroy(),Promise.reject(e)})),e.then(u(this,function(){return this.a?(this.b=t,at(this.f,this.b,"seekrangechanged",this.Fb.bind(this)),this.i=new Ai(this,this.a,this.b),this.i.initialize()):Bi()})).then(u(this,function(){return this.a?(at(this.f,this.a,"error",this.Rb.bind(this)),at(this.f,this.a,"playing",this.Db.bind(this)),at(this.f,this.a,"pause",this.Cb.bind(this)),this.b.lb(this,this.a)):Bi()})).then(u(this,function(){return this.a?Ni(this.i):Bi()})).then(u(this,function(){return this.a?void qi(this):Bi()}))["catch"](u(this,function(t){if(!this.a)return Bi();if("destroy"!=t.type){var e=F(t);this.dispatchEvent(e)}return this.s().then(function(){return Promise.reject(t)})}))},Li.prototype.load=Li.prototype.ea,Yr=Li.prototype,Yr.wb=function(){Ut("load"),this.g.playbackLatency=Bt("load")/1e3,this.f.sa(this.a,"timeupdate")},Yr.Rb=function(){if(this.a.error){var t=this.a.error.code;t!=MediaError.MEDIA_ERR_ABORTED&&(t=Error(Ps[t]||"Unknown playback error."),t.type="playback",t=F(t),this.dispatchEvent(t))}},Yr.Db=function(){Lt("playing"),!this.j&&0>this.l&&(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),this.l)),this.h&&Vi(this)},Yr.Cb=function(){Ut("playing");var t=Bt("playing");if(!isNaN(t)){var e=this.g;e.playTime+=t/1e3}Ki(this)},Yr.Fb=function(t){this.D=t.start},Yr.qb=function(){if(!this.a.paused){Ut("playing");var t=Bt("playing");if(!isNaN(t)){var e=this.g;e.playTime+=t/1e3,Lt("playing")}}return t=this.g,e=this.a,e.getVideoPlaybackQuality&&(e=e.getVideoPlaybackQuality(),t.decodedFrames=e.totalVideoFrames,t.droppedFrames=e.droppedVideoFrames),this.g},Li.prototype.getStats=Li.prototype.qb,Li.prototype.da=function(){return this.b?this.b.ma():[]},Li.prototype.getVideoTracks=Li.prototype.da,Li.prototype.Y=function(){return this.b?this.b.pa():[]},Li.prototype.getAudioTracks=Li.prototype.Y,Li.prototype.$=function(){return this.b?this.b.Oa():[]},Li.prototype.getTextTracks=Li.prototype.$,Li.prototype.selectVideoTrack=function(t,e){return!!this.b&&this.b.selectVideoTrack(t,void 0==e||e)},Li.prototype.selectVideoTrack=Li.prototype.selectVideoTrack,Li.prototype.M=function(t,e,i){return!!this.b&&this.b.nb(t,void 0==e||e,i)},Li.prototype.selectAudioTrack=Li.prototype.M,Li.prototype.fa=function(t){return!!this.b&&this.b.ob(t,!1)},Li.prototype.selectTextTrack=Li.prototype.fa,Li.prototype.V=function(t){this.b&&this.b.Na(t)},Li.prototype.enableTextTrack=Li.prototype.V,Li.prototype.T=function(t){Ki(this),0<=t?this.a.playbackRate=t:this.a.paused||(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),t)),this.l=t},Li.prototype.setPlaybackRate=Li.prototype.T,Li.prototype.K=function(){return this.l},Li.prototype.getPlaybackRate=Li.prototype.K,Li.prototype.R=function(t){this.F=t},Li.prototype.setPlaybackStartTime=Li.prototype.R,Li.prototype.G=function(){return!!this.b&&this.b.mb()},Li.prototype.isLive=Li.prototype.G,Li.prototype.U=function(t){if(t){var e=c(t,"enableAdaptation");null!=e&&(this.c.enableAdaptation=e),e=f(t,"streamBufferSize"),null!=e&&(this.c.streamBufferSize=e),e=f(t,"liveStreamEndTimeout"),null!=e&&(this.c.liveStreamEndTimeout=e),e=f(t,"licenseRequestTimeout"),null!=e&&(this.c.licenseRequestTimeout=e),e=f(t,"mpdRequestTimeout"),null!=e&&(this.c.mpdRequestTimeout=e),e=f(t,"segmentRequestTimeout"),null!=e&&(this.c.segmentRequestTimeout=e),e=p(t,"preferredLanguage"),null!=e&&(this.c.preferredLanguage=e),e=y(t,"restrictions",r),null!=e&&(this.c.restrictions=e.clone()),t=c(t,"disableCacheBustingEvenThoughItMayAffectBandwidthEstimation"),null!=t&&(Ts=!t),this.b&&this.b.T(this.c)}},Li.prototype.configure=Li.prototype.U,Li.prototype.Z=function(){return this.c},Li.prototype.getConfiguration=Li.prototype.Z,Li.prototype.B=function(e,i,n){this.j=null;var r=(Date.now()-i)/1e3*n;this.a.currentTime<this.D+(this.G()?1:.05)?this.a.pause():(r=Math.max(this.D,e+r),this.a.currentTime=r,this.j=t.setTimeout(this.B.bind(this,e,i,n),250))},Li.prototype.L=function(){if(qi(this),!this.a.ended&&!this.a.seeking){var t=this.a.buffered,e=t.length?t.end(t.length-1):0,t=Math.max(e-this.a.currentTime,0),i=this.a.duration,i=isNaN(i)?0:Math.max(i-.05,0),e=e>=i||this.a.currentTime>=i;this.h?(i=this.b.$a(),(e||t>i)&&(Vi(this),this.a.play())):!this.a.paused&&!e&&.5>t&&(this.h=!0,this.a.pause(),this.g.bufferingHistory.push(R()/1e3),Lt("buffering"),this.dispatchEvent(q({type:"bufferingStart"})))}};var Ps={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};Yi.prototype.destroy=function(){this.a.destroy(),this.a=null},Yi.prototype.update=function(t){var e=Wi(t),i=Wi(this.a);return Promise.all([e,i]).then(u(this,function(e){var i=e[0];e=e[1];var n=this.a.a;return Hi(n),zi(n),t.f=this.a.f,t.g=this.a.g?this.a.g.clone():null,t.c=this.a.c,n=[],Ji(t,this.a,i,e,n),i=t.a,Hi(i),zi(i),Promise.resolve(n)}))},e("shaka.media.SimpleAbrManager",Zi),Zi.prototype.destroy=function(){this.f.destroy(),this.a=this.b=this.f=null},Zi.prototype.initialize=function(t,e){this.b||this.a||(this.b=t,this.a=e)},Zi.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4e3,at(this.f,this.b,"bandwidth",this.v.bind(this)),at(this.f,this.a,"adaptation",this.j.bind(this)),at(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)},Zi.prototype.enable=function(t){this.i=t},Zi.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var t=tn(this);return t?t.id:null},Zi.prototype.selectVideoTrack=function(t,e,i){this.g&&this.a.selectVideoTrack(t.id,e,i)},Zi.prototype.v=function(){Date.now()<this.c||this.h()},Zi.prototype.h=function(){if(this.i){var t=tn(this);if(t){if(t.active)return void(this.c=Date.now()+3e3);this.selectVideoTrack(t,!1)}this.c=Number.POSITIVE_INFINITY}},Zi.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3e4)},i(en,z),e("shaka.player.HttpVideoSource",en),en.prototype.T=function(){},en.prototype.destroy=function(){this.a&&(this.a.parentElement.removeChild(this.a),this.a=null),this.v=this.b=null},Yr=en.prototype,Yr.lb=function(t,e){this.v=t;var i=e.mediaKeys;return e.src=this.f,i=e.setMediaKeys(i),
this.c&&(this.a=document.createElement("track"),this.a.src=this.c,e.appendChild(this.a),this.a.track.mode="showing"),i},Yr.X=function(){return Promise.resolve()},Yr.ma=function(){return[]},Yr.pa=function(){return[]},Yr.Oa=function(){return[]},Yr.$a=function(){return 5},Yr.ab=function(){var t=new ci;return t.a=this.b,[t]},Yr.Ka=function(){},en.prototype.selectVideoTrack=function(){return!1},Yr=en.prototype,Yr.nb=function(){return!1},Yr.ob=function(){return!1},Yr.Na=function(t){this.a&&(this.a.track.mode=t?"showing":"disabled")},Yr.pb=function(){},Yr.ua=function(){return[]},Yr.ha=function(){return!1},Yr.mb=function(){return!1},Yr.cb=function(t){for(var e in t){var i=t[e],n=Jr[i]||null;if(n){var r=b(e),n=Error("Key "+r+" is not usable. "+n);n.type="drm",n.code=i,i=F(n),this.dispatchEvent(i)}}},i(nn,z),e("shaka.player.StreamVideoSource",nn),nn.prototype.T=function(t){null!=t.streamBufferSize&&(this.F.streamBufferSize=t.streamBufferSize),null!=t.segmentRequestTimeout&&(this.F.segmentRequestTimeout=t.segmentRequestTimeout),En(this),null!=t.enableAdaptation&&this.G.enable(Boolean(t.enableAdaptation)),null!=t.mpdRequestTimeout&&(this.da=Number(t.mpdRequestTimeout)),null!=t.liveStreamEndTimeout&&(this.Ua=Number(t.liveStreamEndTimeout)),null!=t.preferredLanguage&&(this.K=H(String(t.preferredLanguage))),null!=t.restrictions&&(this.h=t.restrictions,this.L&&an(this))},nn.prototype.destroy=function(){this.B.destroy(),this.ea.destroy(),this.ea=this.B=null,this.Y&&(t.clearTimeout(this.Y),this.Y=null),this.V&&(t.clearTimeout(this.V),this.V=null),this.s=null,this.i.destroy(),this.i=null,l(this.c).forEach(function(t){t.destroy()}),this.b=this.c=null,this.a&&(this.a.destroy(),this.a=null),this.G.destroy(),this.v=this.h=this.U=this.f=this.g=this.Z=this.G=null},Yr=nn.prototype,Yr.lb=function(e,i){if(!this.L){var n=Error("Cannot call attach() right now.");return n.type="app",Promise.reject(n)}return this.v=e,this.f=i,this.U=e.qb(),at(this.i,this.g,"sourceopen",this.yb.bind(this)),at(this.i,this.Z,"bandwidth",this.Sb.bind(this)),this.a.b&&(at(this.i,e,"bufferingStart",this.vb.bind(this)),at(this.i,e,"bufferingEnd",this.ub.bind(this))),n=this.f.mediaKeys,this.f.src=t.URL.createObjectURL(this.g),n=this.f.setMediaKeys(n),Promise.all([this.B,n])},Yr.X=function(){if(this.L){var t=Error("Cannot call load() right now.");return t.type="app",Promise.reject(t)}return this.a&&0!=this.a.a.length?(t=this.a.a,Hi(t),zi(t),0==this.a.a.length||0==this.a.a[0].a.length?(t=Error("The manifest specifies content that cannot be displayed on this browser/platform."),t.type="stream",Promise.reject(t)):(this.L=!0,this.F.initialStreamBufferSize=this.a.c,En(this),an(this),Promise.resolve())):(t=Error("The manifest does not specify any content."),t.type="stream",Promise.reject(t))},Yr.gb=function(t){var e=Date.now(),i=this.V=null,n=this.a.g;(t?this.eb():this.fb(n)).then(u(this,function(t){return i=new Yi(t),i.update(this.a)})).then(u(this,function(t){i.destroy(),i=null;for(var n=0;n<t.length;++n)sn(this,t[n]);this.F.initialStreamBufferSize=this.a.c,En(this),an(this),0==Object.keys(this.c).length?ln(this):rn(this,(Date.now()-e)/1e3)}))["catch"](u(this,function(t){i&&(i.destroy(),i=null),"aborted"!=t.type&&(t=F(t),this.dispatchEvent(t),this.a&&rn(this,0))}))},Yr.fb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")},Yr.eb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")},Yr.ma=function(){if(!this.b.a.hasOwnProperty("video"))return[];for(var t=this.c.video,t=(t=t?t.oa():null)?t.C:0,e=[],i=this.b.get("video"),n=0;n<i.length;++n)for(var r=i[n],a=0;a<r.m.length;++a){var o=r.m[a];if(o.N&&o.J){var h=o.C,o=new s(h,o.bandwidth,o.width,o.height);h==t&&(o.active=!0),e.push(o)}}return e},nn.prototype.getVideoTracks=nn.prototype.ma,nn.prototype.pa=function(){if(!this.b.a.hasOwnProperty("audio"))return[];for(var t=this.c.audio,t=(t=t?t.oa():null)?t.C:0,e=[],i=this.b.get("audio"),n=0;n<i.length;++n)for(var r=i[n],s=r.lang,a=0;a<r.m.length;++a){var h=r.m[a];if(h.N&&h.J){var u=h.C,h=new o(u,h.bandwidth,s);u==t&&(h.active=!0),e.push(h)}}return e},nn.prototype.getAudioTracks=nn.prototype.pa,nn.prototype.Oa=function(){if(!this.b.a.hasOwnProperty("text"))return[];for(var t=this.c.text,e=t?t.oa():null,e=e?e.C:0,i=[],r=this.b.get("text"),s=0;s<r.length;++s)for(var a=r[s],o=a.lang,h=0;h<a.m.length;++h){var u=a.m[h].C,l=new n(u,o);u==e&&(l.active=!0,l.enabled=t.Da()),i.push(l)}return i},nn.prototype.getTextTracks=nn.prototype.Oa,nn.prototype.$a=function(){return Number(this.F.initialStreamBufferSize)},nn.prototype.ab=function(){var t;if(this.L){t=this.a.a[0];for(var e=[],i=0;i<t.a.length;++i)e.push.apply(e,hi(t.a[i]));t=e}else t=[];return t},nn.prototype.Ka=function(t){if(this.L){for(var e={},i=this.a.a[0],n=0;n<i.a.length;++n){var r=i.a[n];e[r.C]=r}for(this.b.a={},i=N(t),n=0;n<i.length;++n){var r=i[n],s=t.get(r);if("video"==r){var a=s[0].id;this.b.push(r,e[a])}else if("audio"==r)for(var a=s[0].b.split(";")[0],o=0;o<s.length;++o){var h=s[o];h.b.split(";")[0]==a&&this.b.push(r,e[h.id])}else for(o=0;o<s.length;++o)a=s[o].id,this.b.push(r,e[a])}this.fa=!0,(t=this.b.get("audio"))&&(un(this,t),this.b.set("audio",t),t=t[0].lang||this.K,V(2,this.K,t)&&(this.fa=!1)),(t=this.b.get("text"))&&(un(this,t),this.b.set("text",t),t=t[0].lang||this.K,V(2,this.K,t)||(this.fa=!1))}},nn.prototype.selectVideoTrack=function(t,e,i){return hn(this,"video",t,e,i)},Yr=nn.prototype,Yr.nb=function(t,e,i){return hn(this,"audio",t,e,i)},Yr.ob=function(t,e){return hn(this,"text",t,e)},Yr.Na=function(t){var e=this.c.text;e&&e.va(t)},Yr.pb=function(t){this.$=t},Yr.ua=function(){return[]},Yr.ha=function(){return!1},Yr.mb=function(){return!!this.a&&this.a.b},Yr.cb=function(t){for(var e,i=!1,n=new _,r=M(this.b),s=0;s<r.length;++s)for(var a=r[s],o=0;o<a.m.length;++o){var h=a.m[o];h.f.forEach(function(t){n.push(t,h)})}for(e in t)if(r=Jr[t[e]]||null,a=n.get(e))for(s=0;s<a.length;++s)h=a[s],o=h.N,h.N=!r,o!=h.N&&(i=!0);else b(e);i&&(on(this),e=this.pa(),t=this.ma(),e=this.b.a.hasOwnProperty("audio")&&0==e.length,t=this.b.a.hasOwnProperty("video")&&0==t.length,e||t)&&(t=Error("The key system has restricted all "+(e&&t?"audio and video tracks.":e?"audio tracks.":"video tracks.")),t.type="drm",t=F(t),this.dispatchEvent(t))},Yr.yb=function(){this.i.sa(this.g,"sourceopen"),ln(this).then(u(this,function(){this.B&&this.B.resolve()}))["catch"](u(this,function(t){this.B&&this.B.reject(t)}))},Yr.tb=function(t){C(t&&t.length==Object.keys(this.c).length);for(var e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=0;n<t.length;++n)var r=t[n],e=Math.min(e,r),i=Math.max(i,r);for(t=mn(this),n=0;n<t.length;++n)t[n].ka(i);yn(this,t,i),n=M(this.b).map(function(t){return t.m}).reduce(function(t,e){return t.concat(e)},[]).map(function(t){var e=[t.I.create()];return t.H&&e.push(t.H.create()),Promise.all(e)}),Promise.all(n).then(u(this,function(t){for(var e=0;e<t.length;++e)t[e][0].ka(i);this.Ra=!0;for(var n in this.s)t=this.s[n],e=this.c[n],Ei(this.U,t.Pa),e.ra(t.Pa,t.Wa,t.Xa);this.s={}}))["catch"](u(this,function(t){"aborted"!=t.type&&(t=F(t),this.dispatchEvent(t))}))},Yr.Jb=function(){this.Y=null,Tn(this);var e=wn(this,mn(this));e&&(this.a.b&&this.Ta!=e.A&&(this.Ta=e.A,null!=this.w&&(t.clearTimeout(this.w),this.w=null)),vn(this,e.start,e.end),this.f.paused||gn(this,this.f.currentTime,e.start,e.end))},Yr.Gb=function(){var t=this.f.currentTime;if(null!=this.D){if(t>=this.D-.01&&t<=this.D+.01)return void(this.D=null);this.D=null}var e=wn(this,mn(this));if(e){var i=e.end;if((e=gn(this,t,e.start,i))||(t<=i+.01?e=!1:(this.f.currentTime=i,e=!0)),!e)for(var n in this.c)this.c[n].jb()}},Yr.Hb=function(){if(!this.a.b){for(var t in this.c)if(!this.c[t].Ga())return;this.Za()}},Yr.vb=function(){l(this.c).every(function(t){return t.Ga()})&&(this.w=t.setTimeout(this.Za.bind(this),1e3*this.Ua))},Yr.ub=function(){null!=this.w&&(t.clearTimeout(this.w),this.w=null)},Yr.Sb=function(){var t=this.U,e=this.Z.getBandwidth();t.estimatedBandwidth=e,t.bandwidthHistory.push(new Pi(e))},Yr.Za=function(){this.w=null,this.g.endOfStream()},i(kn,ut),kn.prototype.g=function(t,e,i){var n=new h;t={stream_id:i.qa,mime_type:t.a,codecs:t.b,init_segment:e,references:i.o};var r=dt(this).put(t);return r.onsuccess=function(){n.resolve(i.qa)},r.onerror=function(){n.reject(r.error)},n},kn.prototype.f=function(t,e){for(var i=Promise.resolve(),n=0;n<t.length();++n)var r=t.get(n),s=n==t.length()-1,s=this.c.bind(this,r,e,s),i=i.then(this.i.bind(this,r)),i=i.then(s);return i.then(function(){return Promise.resolve(e)})["catch"](u(this,function(t){return Mn(this,e.qa),Promise.reject(t)}))},kn.prototype.c=function(t,e,i,n){var r=new h;0==e.ja.byteLength&&(e.Ca=t),e.ja=_n(e.ja,n),e.ib++;var s=q({type:"progress",detail:e.ib/e.Vb*100,bubbles:!0});if(1048576<=e.ja.byteLength||i){i={stream_id:e.qa,segment_id:e.Ja,content:e.ja};var a=pt(this).put(i);e.o.push({start_time:e.Ca.b,start_byte:e.Ca.url.f,end_time:t.a,url:"idb://"+e.qa+"/"+e.Ja}),e.Ja++,e.ja=new ArrayBuffer(0),a.onerror=function(){r.reject(a.error)},a.onsuccess=u(this,function(){this.dispatchEvent(s),r.resolve()})}else this.dispatchEvent(s),r.resolve();return r},kn.prototype.i=function(t){var e=new Le;return e.c=1e3*this.b,ze(t.url,e,this.j)},i(In,ti),In.prototype.destroy=function(){this.w=this.g=null,ti.prototype.destroy.call(this)},In.prototype.la=function(t){return Cn(this,R()/1e3),ti.prototype.la.call(this,t)},In.prototype.Ha=function(t){return t instanceof In&&(ii(this,t),this.h=Math.max(this.h,t.h),null==this.c?(this.f=t.f,Nn(this)):Dn(this),!0)},In.prototype.ka=function(t){return t=ti.prototype.ka.call(this,t),Math.min.apply(null,this.o.filter(function(t){return null!=t.a}).map(function(t){return t.a-t.b})),null!=this.c&&(this.l+=t,this.a+=t,this.c+=t),t},In.prototype.Ea=function(){return Rn(this,R()/1e3)},xn.prototype.destroy=function(){this.h=this.i=this.g=null,this.a.g(),this.a=null,this.c&&(this.c.g(),this.c=null),this.b=null},xn.prototype.create=function(){if(this.b)return this.b;var t=[ze(this.a)];return"webm"==this.f&&t.push(ze(this.c)),this.b=Promise.all(t).then(u(this,function(t){var e=t[0];t=t[1]||null;var i=null;if("mp4"==this.f?(i=new Qe,i=i.parse(new DataView(e),this.a.f,this.a.b,this.h)):"webm"==this.f&&(i=new Ze,i=i.parse(new DataView(e),new DataView(t),this.a.b,this.h)),!i)return e=Error("Failed to parse SegmentReferences from "+this.a.toString()+" (or one of its fallbacks)."),e.type="stream",Promise.reject(e);var n;return n="dynamic"==this.g.type?new In(i,this.g,this.i,this.j):new ti(i),Promise.resolve(n)}))},On.prototype.destroy=function(){this.g=this.f=this.c=this.b=null,this.a&&(this.a.destroy(),this.a=null)},On.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var t=this.f.a,e=kr(t.c,t.a||1,this.c.a||0),i=[],n=0;n<e.length;++n){var r=e[n].start,s=r/t.a,a=e[n].end/t.a,r=Tr(this.g,this.f,n+t.j,r);if(!r)return t=Error("Failed to generate media URL."),t.type="dash",Promise.reject(t);var o=(t.i||0)/t.a;i.push(new We(s-o,a-o,r))}return"dynamic"==this.b.type?this.a=new In(i,this.b,this.c,this.h):this.a=new ti(i),Promise.resolve(this.a)},Yn.prototype.clone=function(){var t=new Yn;return t.u=lr(this.u),t.g=this.g,t.f=this.f,t.a=cr(this.a),t.b=cr(this.b),t.c=cr(this.c),t},Wn.prototype.clone=function(){var t=new Wn;return t.url=lr(this.url),t.a=cr(this.a),t},Jn.prototype.clone=function(){var t=new Jn;return t.url=lr(this.url),t.a=cr(this.a),t},$n.prototype.clone=function(){var t=new $n;return t.u=lr(this.u),t.f=this.f,t.g=this.g,t.b=this.b,t.i=this.i,t.h=cr(this.h),t.a=lr(this.a)||[],t.c=cr(this.c),t},Xn.prototype.clone=function(){var t=new Xn;return t.b=lr(this.b),t.a=cr(this.a),t},Qn.prototype.clone=function(){var t=new Qn;return t.a=this.a,t.i=this.i,t.b=this.b,t.j=this.j,t.h=this.h,t.f=this.f,t.g=this.g,t.c=cr(this.c),t},Zn.prototype.clone=function(){var t=new Zn;return t.a=lr(this.a)||[],t},tr.prototype.clone=function(){var t=new tr;return t.b=this.b,t.a=this.a,t.c=this.c,t},er.prototype.clone=function(){return new er(this.na,this.end)},Ln.TAG_NAME="MPD",Un.TAG_NAME="Period",Bn.TAG_NAME="AdaptationSet",Kn.TAG_NAME="Role",qn.TAG_NAME="ContentComponent",Fn.TAG_NAME="Representation",Vn.TAG_NAME="ContentProtection",Hn.TAG_NAME="cenc:pssh",zn.TAG_NAME="BaseURL",Gn.TAG_NAME="Location",Yn.TAG_NAME="SegmentBase",Wn.TAG_NAME="RepresentationIndex",Jn.TAG_NAME="Initialization",$n.TAG_NAME="SegmentList",Xn.TAG_NAME="SegmentURL",Qn.TAG_NAME="SegmentTemplate",Zn.TAG_NAME="SegmentTimeline",tr.TAG_NAME="S",Ln.prototype.parse=function(t,e){this.url=t.hb,this.id=fr(e,"id",mr),this.type=fr(e,"type",mr)||"static",this.b=fr(e,"mediaPresentationDuration",dr),this.h=fr(e,"minBufferTime",dr,this.h),this.g=fr(e,"minimumUpdatePeriod",dr,this.g),this.c=fr(e,"availabilityStartTime",pr,this.c),this.f=fr(e,"timeShiftBufferDepth",dr,this.f),this.i=fr(e,"suggestedPresentationDelay",dr,this.i);var i=t.u,n=hr(this,e,zn);this.u=nr(i,n),(n=ar(this,e,Gn))&&(this.j=rr(i,n.url)),this.a=hr(this,e,Un)},Un.prototype.parse=function(t,e){this.id=fr(e,"id",mr),this.start=fr(e,"start",dr),this.a=fr(e,"duration",dr);var i=hr(this,e,zn);this.u=nr(t.u,i),this.c=ar(this,e,Yn),this.f=ar(this,e,$n),this.g=ar(this,e,Qn),this.b=hr(this,e,Bn),ir(this)},Bn.prototype.parse=function(t,e){var i=ar(this,e,qn)||{},n=ar(this,e,Kn);this.id=fr(e,"id",mr),this.group=fr(e,"group",gr),this.lang=fr(e,"lang",mr,i.lang),this.contentType=fr(e,"contentType",mr,i.contentType),this.width=fr(e,"width",vr),this.height=fr(e,"height",vr),this.b=fr(e,"mimeType",mr),this.i=fr(e,"codecs",mr),this.c=n&&"main"==n.value,this.lang&&(this.lang=H(this.lang)),i=hr(this,e,zn),this.u=nr(t.u,i),this.j=hr(this,e,Vn),!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]),this.f=t.c?sr(this,e,t.c):ar(this,e,Yn),this.g=t.f?sr(this,e,t.f):ar(this,e,$n),this.h=t.g?sr(this,e,t.g):ar(this,e,Qn),this.a=hr(this,e,Fn),!this.b&&this.a.length&&(this.b=this.a[0].f,!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]))},Kn.prototype.parse=function(t,e){this.value=fr(e,"value",mr)},qn.prototype.parse=function(t,e){this.id=fr(e,"id",mr),this.lang=fr(e,"lang",mr),this.contentType=fr(e,"contentType",mr),this.lang&&(this.lang=H(this.lang))},Fn.prototype.parse=function(t,e){this.id=fr(e,"id",mr),this.bandwidth=fr(e,"bandwidth",vr),this.width=fr(e,"width",vr,t.width),this.height=fr(e,"height",vr,t.height),this.f=fr(e,"mimeType",mr,t.b),this.h=fr(e,"codecs",mr,t.i),this.lang=t.lang;var i=hr(this,e,zn);this.u=nr(t.u,i),this.c=hr(this,e,Vn),this.g=t.f?sr(this,e,t.f):ar(this,e,Yn),this.b=t.g?sr(this,e,t.g):ar(this,e,$n),this.a=t.h?sr(this,e,t.h):ar(this,e,Qn),this.c=this.c.concat(t.j)},Vn.prototype.parse=function(t,e){this.f=e,this.c=fr(e,"schemeIdUri",mr);var i=fr(e,"cenc:default_KID",mr);i&&(this.b=i.replace(/[-]/g,"")),this.a=ar(this,e,Hn)},Hn.prototype.parse=function(t,e){var i=ur(e);if(i){this.psshBox=w(i);try{this.parsedPssh=new Ot(this.psshBox)}catch(n){if(!(n instanceof RangeError))throw n}}},zn.prototype.parse=function(t,e){this.url=ur(e)},Gn.prototype.parse=function(t,e){this.url=ur(e)},Yn.prototype.parse=function(t,e){this.u=t.u||this.u,this.g=fr(e,"timescale",vr,this.g),this.f=fr(e,"presentationTimeOffset",gr,this.f),this.a=fr(e,"indexRange",yr,this.a),this.b=ar(this,e,Wn)||this.b,this.c=ar(this,e,Jn)||this.c},Wn.prototype.parse=function(t,e){var i=fr(e,"sourceURL",mr);this.url=rr(t.u,i),this.a=fr(e,"range",yr,cr(t.a))},Jn.prototype.parse=function(t,e){var i=fr(e,"sourceURL",mr);this.url=rr(t.u,i),this.a=fr(e,"range",yr)},$n.prototype.parse=function(t,e){this.u=t.u||this.u,this.f=fr(e,"timescale",vr,this.f),this.g=fr(e,"presentationTimeOffset",gr,this.g),this.b=fr(e,"duration",vr,this.b);var i=fr(e,"startNumber",vr);null!=i&&(this.i=i),this.h=ar(this,e,Jn)||this.h,this.a=(i=hr(this,e,Xn))&&0<i.length?i:this.a,this.c=ar(this,e,Zn)||this.c},Xn.prototype.parse=function(t,e){var i=fr(e,"media",mr);this.b=rr(t.u,i),this.a=fr(e,"mediaRange",yr)},Qn.prototype.parse=function(t,e){this.a=fr(e,"timescale",vr,this.a),this.i=fr(e,"presentationTimeOffset",gr,this.i),this.b=fr(e,"duration",vr,this.b);var i=fr(e,"startNumber",gr);null!=i&&(this.j=i),this.h=fr(e,"media",mr,this.h),this.f=fr(e,"index",mr,this.f),this.g=fr(e,"initialization",mr,this.g),this.c=ar(this,e,Zn)||this.c},Zn.prototype.parse=function(t,e){this.a=hr(this,e,tr)},tr.prototype.parse=function(t,e){this.b=fr(e,"t",gr),this.a=fr(e,"d",gr),this.c=fr(e,"r",br)},jr.prototype.destroy=function(){this.f=this.g=this.b=this.c=null,this.a&&(this.a.destroy(),this.a=null)},jr.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var t=this.g.b,e=[];t.c&&(e=kr(t.c,t.f||1,this.b.a||0));var i=0;t.b&&t.i?i=(t.i-1)*t.b:0<e.length&&(i=e[0].start-(t.g||0));var n=t.a.length;0<e.length&&e.length!=t.a.length&&(n=Math.min(e.length,t.a.length));for(var r=[],s=0;s<n;++s){var a=t.a[s],o=i/t.f,h=null,u=null;t.b?(h=i+t.b,u=h/t.f):0<e.length?(h=e[s].end-(t.g||0),u=h/t.f):(u=o+this.b.a,h=u*t.f);var i=h,h=0,l=null;a.a&&(h=a.a.na,l=a.a.end),r.push(new We(o,u,new Ve(this.f,a.b,h,l)))}return"dynamic"==this.c.type?this.a=new In(r,this.c,this.b,this.h):this.a=new ti(r),Promise.resolve(this.a)},i(Ar,In),Ar.prototype.destroy=function(){this.B=this.s=null,In.prototype.destroy.call(this)},Ar.prototype.la=function(t){var e=R()/1e3;return _r(this,e),Cn(this,e),ti.prototype.la.call(this,t)},Ar.prototype.Ha=function(t){return null==this.b&&t instanceof Ar&&null!=t.b&&(this.b=t.b,this.v=t.v,this.j=t.j,this.f=t.f,this.h=t.h,ii(this,t),_r(this,R()/1e3),Nn(this),!0)},Ar.prototype.ka=function(t){return t=In.prototype.ka.call(this,t),null!=this.b&&(this.b+=t,this.v+=t),t},Ar.prototype.Ea=function(){var t=R()/1e3;return _r(this,t),Rn(this,t)},Mr.prototype.destroy=function(){this.g=this.c=this.b=this.f=null,this.a&&(this.a.destroy(),this.a=null)},Mr.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.f.type)try{this.a=new Ar(this.f,this.b,this.c,this.h,this.g)}catch(t){return Promise.reject(t)}else{var e;if(e=this.c.a,e=wr(this.g,this.c,1,Math.ceil(this.b.a/(e.b/e.a)))){if(0<e.length){var i=e[e.length-1];e[e.length-1]=Je(i,i.b,this.b.a)}e=new ti(e)}else e=null;if(this.a=e,!this.a)return e=Error("Failed to generate SegmentReferences"),e.type="stream",Promise.reject(e)}return Promise.resolve(this.a)},i(Fr,nn),e("shaka.player.OfflineVideoSource",Fr),Fr.prototype.T=function(t){null!=t.licenseRequestTimeout&&(this.l.licenseRequestTimeout=t.licenseRequestTimeout),null!=t.segmentRequestTimeout&&(this.l.segmentRequestTimeout=t.segmentRequestTimeout),nn.prototype.T.call(this,t)},e("shaka.player.OfflineVideoSource.retrieveGroupIds",function(){var t=new gt,e=lt(t).then(function(){return mt(t)});return e.then(function(){ct(t)})["catch"](function(){ct(t)}),e}),Fr.prototype.xa=function(e,i,n,r){var s,a=null,o={},h=[];return e=new Ve(this.ga,[new Ae(e)]),Sr(new Pr(e,this.da)).then(u(this,function(t){return this.a=Nr(new Ir(n),t,this.ga),this.a.b?(t=Error("Unable to store live streams offline."),t.type="app",Promise.reject(t)):(this.T({preferredLanguage:i}),nn.prototype.X.call(this))})).then(u(this,function(){var e=document.createElement("video");return e.src=t.URL.createObjectURL(this.g),s=new Ai(null,e,this),null!=this.l.licenseRequestTimeout&&(s.w=Number(this.l.licenseRequestTimeout)),at(this.i,s,"sessionReady",this.ta.bind(this)),at(this.i,s,"error",function(t){a=t}),s.initialize()})).then(u(this,function(){for(var t=M(this.b),e=0;e<t.length;++e)for(var i=t[e],n=0;n<i.m.length;++n){var s=i.m[n];o[s.C]=s}return r()})).then(u(this,function(t){for(var e=0;e<t.length;++e){var i=t[e],n=o[i];if(!n)return Promise.reject(Error("Invalid stream ID chosen: "+i));h.push(n)}var r=["audio","video"];return h=h.filter(function(t){return!(0>r.indexOf(t.a.split("/")[0]))}),t=h.map(function(t){return t.H.create()}),Promise.all(t)})).then(u(this,function(t){for(var e=h,i=[],n=0;n<e.length;++n)try{i[n]=this.g.addSourceBuffer(ai(e[n]))}catch(r){}if(e.length!=i.length)t=Error("Error initializing streams."),t.type="storage",t=Promise.reject(t);else{for(n=0;n<t.length;++n)(e=t[n])&&i[n].appendBuffer(e);t=Promise.resolve()}return t})).then(u(this,function(){return _i(s,this.timeoutMs)})).then(u(this,function(){return a?Promise.reject(a):Vr(this,h,s.a,this.a.a[0].b)})).then(u(this,function(t){return this.R=t,a?(Hr(this),Promise.reject(a)):Promise.resolve(t)}))},e("shaka.player.OfflineVideoSource.prototype.store",Fr.prototype.xa),Fr.prototype.Aa=function(t){this.ga=t},Fr.prototype.setNetworkCallback=Fr.prototype.Aa,Fr.prototype.ta=function(t){this.M.push(t.detail.sessionId)},Fr.prototype.X=function(){var t,e,i=new gt;return lt(i).then(u(this,function(){return wt(i,this.R)})).then(u(this,function(n){var r=[];this.M=n.session_ids,t=n.duration,e={keySystem:n.key_system,distinctiveIdentifierRequired:n.distinctive_identifier,persistentStorageRequired:!0,audioRobustness:n.audio_robustness,videoRobustness:n.video_robustness,withCredentials:n.with_credentials,licenseServerUrl:n.license_server};for(var s=0;s<n.stream_ids.length;++s)r.push(Tt(i,n.stream_ids[s]));return Promise.all(r)})).then(u(this,function(i){var n=t,r=e,s=new li;s.c=5;for(var a=new ui,o=0;o<i.length;++o){var h=i[o],u=new si,l=new ri(h.references),c=new Ye(null,h.init_segment);u.I=l,u.H=c,u.a=h.mime_type,u.b=h.codecs,u.N=!0,this.j&&(null!=this.j.licenseServerUrl&&(r.licenseServerUrl=this.j.licenseServerUrl),null!=this.j.withCredentials&&(r.withCredentials=this.j.withCredentials),r.licensePostProcessor=this.j.licensePostProcessor,r.licensePreProcessor=this.j.licensePreProcessor,r.serverCertificate=this.j.serverCertificate),h=x(r),l=new oi,l.m.push(u),l.a.push(h),l.contentType=u.a.split("/")[0],a.a.push(l),a.b=n}return s.a.push(a),this.a=s,nn.prototype.X.call(this)})).then(function(){return ct(i),Promise.resolve()})["catch"](function(t){return ct(i),Promise.reject(t)})},Fr.prototype.za=function(t,e){t&&(this.j={licenseServerUrl:t.licenseServerUrl,withCredentials:t.withCredentials,serverCertificate:t.serverCertificate,licensePreProcessor:t.licensePreProcessor,licensePostProcessor:t.licensePostProcessor});var i=null;return zr(this)["catch"](function(t){return e?(i=t,Promise.resolve()):Promise.reject(t)}).then(u(this,function(){return Hr(this)})).then(function(){return Promise.resolve(i)})},Fr.prototype.deleteGroup=Fr.prototype.za,Fr.prototype.ua=function(){return this.M},Fr.prototype.ha=function(){return!0},i(Gr,nn),e("shaka.player.DashVideoSource",Gr),Gr.prototype.Aa=function(t,e,i){this.R.push(t),this.ga.push(e||""),this.ta.push(i||"")},Gr.prototype.addExternalCaptions=Gr.prototype.Aa,Gr.prototype.xa=function(t){this.j=t},Gr.prototype.setNetworkCallback=Gr.prototype.xa,Gr.prototype.destroy=function(){this.l=this.j=this.M=null,nn.prototype.destroy.call(this)},Gr.prototype.X=function(){var t=new Ve(this.j,[new Ae(this.za)]);return Sr(new Pr(t,this.da)).then(u(this,function(t){this.l=t;for(var e=0;e<this.R.length;e++){var i=t,n=this.R[e],r=this.ga[e],s=this.ta[e];if(0!==i.a.length){var a=new Bn;a.contentType="text",a.lang=r||"en",a.c=!0,r=new Fn,r.bandwidth=0,r.f=s||"text/vtt",r.u=[new Ae(n)],a.a.push(r),i.a[0].b.push(a),ir(i.a[0])}}return this.a=Nr(new Ir(this.M),t,this.j),nn.prototype.X.call(this)}))},Gr.prototype.fb=function(t){return Sr(new Pr(t,this.da)).then(u(this,function(t){return this.l=t,t=Nr(new Ir(this.M),t,this.j),Promise.resolve(t)}))},Gr.prototype.eb=function(){var t=Nr(new Ir(this.M),this.l,this.j);return Promise.resolve(t)}}).bind(r,this)(),"undefined"!=typeof t&&t.exports?t.exports=r.shaka:(n=function(){return r.shaka}.call(e,i,e,t),!(void 0!==n&&(t.exports=n)))}()},function(e,i){e.exports=t}])});